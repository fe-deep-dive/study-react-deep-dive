# 05ì¥ ë¦¬ì•¡íŠ¸ì™€ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬

ì´ë²ˆ ì¥ì—ì„œëŠ” **ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ í•„ìš”ì„±**ê³¼ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ **ì–´ë–»ê²Œ ë¦¬ì•¡íŠ¸ì™€ í•¨ê»˜ ì‘ë™í•˜ëŠ”ì§€** ì‚´í´ë³¸ë‹¤.

## 5.1 ìƒíƒœ ê´€ë¦¬ëŠ” ì™œ í•„ìš”í•œê°€?

**'ìƒíƒœ'ë€?**

- UI: ê¸°ë³¸ì ìœ¼ë¡œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ìƒíƒœë€, ìƒí˜¸ ì‘ìš©ì´ ê°€ëŠ¥í•œ ëª¨ë“  ìš”ì†Œì˜ í˜„ì¬ ê°’ì„ ì˜ë¯¸í•œë‹¤.<br/>
  ex) ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ, ë¼ë””ì˜¤ë¥¼ ë¹„ë¡¯í•œ ê°ì¢… input, ì•Œë¦¼ì°½ì˜ ë…¸ì¶œ ì—¬ë¶€ ë“±
- URL: ë¸Œë¼ìš°ì €ì—ì„œ ê´€ë¦¬ë˜ê³  ìˆëŠ” ìƒíƒœê°’ì´ë‹¤.<br/>
  ex) `https://www.airbnb.co.kr/rooms/34113796?adults=2`ì™€ ê°™ì€ ì£¼ì†Œì—ëŠ” `roomId=34113796`ê³¼ `adults=2`ë¼ê³  í•˜ëŠ” ìƒíƒœê°€ ì¡´ì¬í•œë‹¤.
- í¼(form): ë¡œë”© ì¤‘ì¸ì§€(loading), í˜„ì¬ ì œì¶œëëŠ”ì§€(submit), ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•œì§€(disables), ê°’ì´ ìœ ìš”í•œì§€(validation) ë“±ì˜ ìƒíƒœê°€ ìˆë‹¤.
- ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ ê°’: ëŒ€í‘œì ìœ¼ë¡œ API ìš”ì²­ì´ ìˆë‹¤.

ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì ìœ¼ë¡œ ê´€ë¦¬í•´ì•¼í•  ìƒíƒœê°€ ìˆë‹¤ê³  ê°€ì •í•˜ë©´ ìƒíƒœì˜ ìœ„ì¹˜ì™€ ë²”ìœ„ ê´€ë¦¬, ìƒíƒœ ë³€í™” ê°ì§€, tearing ë°©ì§€ ë“± ìƒíƒœ ê´€ë¦¬ê°€ ì–´ë ¤ì›Œì§„ë‹¤.

<details>
<summary>tearingì´ë€?</summary>

React 18ì˜ Concurrent Rendering(ë™ì‹œì„± ë Œë”ë§)ìœ¼ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” UIì˜ ë¶ˆì¼ì¹˜ í˜„ìƒì´ë‹¤.<br/>
React 18ì˜ ë Œë”ë§ ê³¼ì •ì—ì„œ Suspend(ì¼ì‹œ ì¤‘ì§€)ê°€ ë°œìƒí–ˆì„ ë•Œ, <br/>
ë Œë”ë§ ë„ì¤‘ Reactê°€ ìŠ¤í† ì–´ë¥¼ ì—…ë°ì´íŠ¸í•´ì„œ ë°ì´í„°ê°€ ë³€ê²½ë˜ë©´, tearing(UIì˜ ë¶ˆì¼ì¹˜)ë¥¼ ìœ ë°œí•œë‹¤.

![image](https://github.com/parkyolo/study-react-deep-dive/assets/39394642/9b447c18-6189-4dcf-a345-5b7768d5f302)

</details>

### 5.1.1 ë¦¬ì•¡íŠ¸ ìƒíƒœ ê´€ë¦¬ì˜ ì—­ì‚¬

ë¦¬ì•¡íŠ¸ëŠ” ë‹¨ìˆœíˆ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë¯€ë¡œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ë„ ê°œë°œìì— ë”°ë¼, ì‹œê°„ì— ë”°ë¼ ë§ì€ ì°¨ì´ê°€ ìˆë‹¤. ê·¸ ì—­ì‚¬ë¥¼ ì‚´í´ë³´ì.

**Flux íŒ¨í„´ì˜ ë“±ì¥**

ê¸°ì¡´ MVC íŒ¨í„´ì€ ëª¨ë¸ê³¼ ë·°ê°€ ë§ì•„ì§ˆìˆ˜ë¡ ë³µì¡ë„ê°€ ì¦ê°€í•œë‹¤.

![image](https://github.com/parkyolo/study-react-deep-dive/assets/39394642/f37d483b-0aca-4c2f-b8ec-161361d45279)

í˜ì´ìŠ¤ë¶ íŒ€ì€ ì´ëŸ¬í•œ ë¬¸ì œì˜ ì›ì¸ì„ ì–‘ë°©í–¥ ë°ì´í„° ë°”ì¸ë”© ë³´ê³  ì–‘ë°©í–¥ì´ ì•„ë‹Œ **ë‹¨ë°©í–¥ìœ¼ë¡œ ë°ì´í„° íë¦„ì„ ë³€ê²½**í•˜ëŠ” Flux íŒ¨í„´ì„ ì œì•ˆí•œë‹¤.

![image](https://github.com/parkyolo/study-react-deep-dive/assets/39394642/7ef849d9-74ca-4722-b704-cdb6989c0f29)

- ì•¡ì…˜(action): ì–´ë– í•œ **ì‘ì—…ì„ ì²˜ë¦¬í•  ì•¡ì…˜**ê³¼ ê·¸ ì•¡ì…˜ ë°œìƒ ì‹œ í•¨ê»˜ í¬í•¨ì‹œí‚¬ **ë°ì´í„°**ë¥¼ ì˜ë¯¸í•œë‹¤. ì•¡ì…˜ íƒ€ì…ê³¼ ë°ì´í„°ë¥¼ ê°ê° ì •ì˜í•´ ì´ë¥¼ ë””ìŠ¤íŒ¨ì²˜ë¡œ ë³´ë‚¸ë‹¤.
- ë””ìŠ¤íŒ¨ì²˜(dispatcher): ì•¡ì…˜ì„ ìŠ¤í† ì–´ì— ë³´ë‚´ëŠ” ì—­í• ì„ í•œë‹¤. **ì½œë°± í•¨ìˆ˜ í˜•íƒœ**ë¡œ ì•ì„œ ì•¡ì…˜ì´ ì •ì˜í•œ íƒ€ì…ê³¼ ë°ì´í„°ë¥¼ ëª¨ë‘ ìŠ¤í† ì–´ì— ë³´ë‚¸ë‹¤.
- ìŠ¤í† ì–´(store): ì—¬ê¸°ì—ì„œ ì‹¤ì œ ìƒíƒœì— ë”°ë¥¸ **ê°’ê³¼ ìƒíƒœë¥¼ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ë©”ì„œë“œ**ë¥¼ ê°€ì§€ê³  ìˆë‹¤.
- ë·°(view): **ë¦¬ì•¡íŠ¸ì˜ ì»´í¬ë„ŒíŠ¸**ì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ìœ¼ë¡œ, ìŠ¤í† ì–´ì—ì„œ ë§Œë“¤ì–´ì§„ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ í™”ë©´ì„ ë Œë”ë§í•˜ëŠ” ì—­í• ì„ í•œë‹¤. ë·°ì—ì„œ **ì‚¬ìš©ìì˜ ì…ë ¥ì´ë‚˜ í–‰ìœ„ì— ë”°ë¼ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸**í•˜ê³ ì í•  ë•Œ ë·°ì—ì„œ ì•¡ì…˜ì„ í˜¸ì¶œí•˜ëŠ” êµ¬ì¡°ë¡œ êµ¬ì„±ëœë‹¤.

```jsx
type StoreState = {
  count: number
}

// ì•¡ì…˜ ì¢…ë¥˜ì™€ ë°ì´í„° ì •ì˜
type Action = { type: 'add'; payload: number }

function reducer(preState: StoreState, action: Action) {
  const { type: ActionType } = action
  if (ActionType === 'add') {
    return {
      count: prevState.count + action.payload,
    }
  }

  throw new Error(`Unexpected Action [${ActionType}]`)
}

export default App() {
  const [state, dispatcher] = useReducer(reducer, {count: 0})

  function handleClick() {
    // dispatcherë¡œ action ì‹¤í–‰
    dispatcher({ type: 'add', payload: 1})
  }

  return (
    // ...
  )
}
```


**ì‹œì¥ ì§€ë°°ì ë¦¬ë•ìŠ¤ì˜ ë“±ì¥**

ë¦¬ë•ìŠ¤ ë˜í•œ ìµœì´ˆì—ëŠ” Flux êµ¬ì¡°ë¥¼ í‘œí˜„í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì§„ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¤‘ í•˜ë‚˜ì˜€ë‹¤. íŠ¹ë³„í•œ ê²ƒì€ ì—¬ê¸°ì— Elm ì•„í‚¤í…ì²˜ë¥¼ ë„ì…í–ˆë‹¤ëŠ” ê²ƒì´ë‹¤.

Elmì€ ì›¹í˜ì´ì§€ë¥¼ ì„ ì–¸ì ìœ¼ë¡œ ì‘ì„±í•˜ê¸° ìœ„í•œ ì–¸ì–´ë‹¤. Fluxì™€ ë§ˆì°¬ê°€ì§€ë¡œ ë°ì´í„° íë¦„ì„ ì„¸ ê°€ì§€(model, update, view)ë¡œ ë¶„ë¥˜í•˜ê³ , ì´ë¥¼ ë‹¨ë°©í–¥ìœ¼ë¡œ ê°•ì œí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìƒíƒœë¥¼ ì•ˆì •ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³ ì ë…¸ë ¥í–ˆë‹¤. ê·¸ë¦¬ê³  ë¦¬ë•ìŠ¤ëŠ” ì´ Elm ì•„í‚¤í…ì²˜ì˜ ì˜í–¥ì„ ë°›ì•„ ì‘ì„±ëë‹¤.

ë¦¬ë•ìŠ¤ëŠ” **í•˜ë‚˜ì˜ ìƒíƒœ ê°ì²´ë¥¼ ìŠ¤í† ì–´ì— ì €ì¥**í•´ ë‘ê³ , ì´ ê°ì²´ë¥¼ **ì—…ë°ì´íŠ¸í•˜ëŠ” ì‘ì—…ì„ ë””ìŠ¤íŒ¨ì¹˜**í•´ ì—…ë°ì´íŠ¸ë¥¼ ìˆ˜í–‰í•œë‹¤. ì´ëŸ¬í•œ ì‘ì—…ì€ **reducer í•¨ìˆ˜**ë¡œ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆëŠ”ë°, ì´ í•¨ìˆ˜ì˜ ì‹¤í–‰ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœì— ëŒ€í•œ **ì™„ì „íˆ ìƒˆë¡œìš´ ë³µì‚¬ë³¸**ì„ ë°˜í™˜í•œ ë‹¤ìŒ, ì• í”Œë¦¬ì¼€ì´ì…˜ì— ìƒˆë¡­ê²Œ ë§Œë“¤ì–´ì§„ **ìƒíƒœë¥¼ ì „íŒŒ**í•œë‹¤.

ë¦¬ë•ìŠ¤ì˜ ë“±ì¥ì€ prop ë‚´ë ¤ì£¼ê¸° ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆì—ˆê³ , ìŠ¤í† ì–´ê°€ í•„ìš”í•œ ì»´í¬ë„ŒíŠ¸ì—ì„œ connectë§Œ ì“°ë©´ ìŠ¤í† ì–´ì— ë°”ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.

í•˜ì§€ë§Œ ë¦¬ë•ìŠ¤ê°€ ì²˜ìŒ ë“±ì¥í–ˆì„ ë•Œ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ê°€ ë„ˆë¬´ ë§ë‹¤ëŠ” ë¹„íŒì˜ ëª©ì†Œë¦¬ê°€ ìˆì—ˆë‹¤. ì§€ê¸ˆì€ ì´ëŸ¬í•œ ì‘ì—…ì´ ë§ì´ ê°„ì†Œí™”ë˜ì—ˆë‹¤.


**Context APIì™€ useContext**

ë¦¬ì•¡íŠ¸ íŒ€ì€ prop ë‚´ë ¤ì£¼ê¸° ë¬¸ì œì™€ ë¦¬ë•ìŠ¤ì˜ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ì˜ ë¶€ë‹´ì„ í•´ê²°í•˜ê¸° ìœ„í•´ ë¦¬ì•¡íŠ¸ 16.3ì—ì„œ ì „ì—­ ìƒíƒœë¥¼ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì— ì£¼ì…í•  ìˆ˜ ìˆëŠ” ìƒˆë¡œìš´ Context APIë¥¼ ì¶œì‹œí–ˆë‹¤.

Context APIë¥¼ ì‚¬ìš©í•˜ë©´ ì›í•˜ëŠ” ê³³ì—ì„œ Context Providerê°€ ì£¼ì…í•˜ëŠ” ìƒíƒœë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ëœ ê²ƒì´ë‹¤.

ë¦¬ì•¡íŠ¸ 16.3 ë²„ì „ ì´ì „ì—ë„ contextê°€ ì¡´ì¬í–ˆìœ¼ë©°, ì´ë¥¼ ë‹¤ë£¨ê¸° ìœ„í•œ getChildContext() ì˜ˆì œë¥¼ ë³´ì.

```jsx
class MyComponent extends React.Component {
  // childContextTypesì™€ getChildContext()ë¥¼ ì¶”ê°€í•¨ìœ¼ë¡œì¨ ReactëŠ” ìë™ìœ¼ë¡œ ì •ë³´ë¥¼ í•˜ìœ„ì— ì „ë‹¬í•œë‹¤.
  static childContextTypes = {
    name: PropTypes.string,
    age: PropTypes.number,
  };

  getChildContext() {
    return {
      name: 'foo',
      age: 30,
    }
  }

  render() {
    return <ChildComponent/>;
  }
}

function ChildComponent(props, context) {
  return (
    <div>
      <p>Name: {context.name}</p>
      <p>Age: {context.age}</p>
    </div>
  )
}

// contextTypesê°€ ì •ì˜ë˜ì§€ ì•Šìœ¼ë©´ contextëŠ” ë¹ˆ ê°ì²´ê°€ ëœë‹¤.
ChildComponent.contextTypes = {
  name: PropTypes.string,
  age: PropTypes.number,
}
```

í•˜ì§€ë§Œ ì´ ë°©ì‹ì—ëŠ” ë¬¸ì œì ì´ ìˆë‹¤.

- ìƒìœ„ ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ë˜ë©´ getChildContextë„ í˜¸ì¶œë¨ê³¼ ë™ì‹œì— shouldComponentUpdateê°€ í•­ìƒ trueë¥¼ ë°˜í™˜í•´ **ë¶ˆí•„ìš”í•˜ê²Œ ë Œë”ë§**ì´ ì¼ì–´ë‚œë‹¤ëŠ” ì 
- getChildContextë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” contextë¥¼ ì¸ìˆ˜ë¡œ ë°›ì•„ì•¼ í•˜ë¯€ë¡œ ì»´í¬ë„ŒíŠ¸ì™€ **ê²°í•©ë„ê°€ ë†’ì•„ì§„ë‹¤**ëŠ” ì 

ì´ëŸ¬í•œ ë‹¨ì ì„ í•´ê²°í•˜ê¸° ìœ„í•´ 16.3 ë²„ì „ì—ì„œ ìƒˆë¡œìš´ contextê°€ ì¶œì‹œëë‹¤.

Context APIë¥¼ ì‚¬ìš©í•´ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì— ìƒíƒœë¥¼ ì „ë‹¬í•˜ëŠ” ì˜ˆë‹¤.

```jsx
type Counter = {
  count: number
}

const CounterContext = createContext<Counter | undefined>(undefined)

class CounterComponent extends Component {
  render() {
    return (
      <CounterContext.Consumer>'
        {/* Providerë¡œ ì£¼ì…ëœ ìƒíƒœë¥¼ ìì‹ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš© */}
        {(state) => <p>{state?.count}</p>}
      </CounterContext.Consumer>
    )
  }
}

class DummyParent extends Component {
  render() {
    return (
      <>
        <CounterComponent />
      </>
    )
  }
}

export default class MyApp extends Component<{}, Counter> {
  // ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì¸ MyAppì— ìƒíƒœ ì„ ì–¸
  state = { count: 0 }

  componentDidMount() {
    this.setState({ count: 1 })
  }

  handleClick = () => {
    this.setState((state) => ({ count: state.count + 1 }))
  }

  render() {
    return (
      {/* Contextë¡œ ìƒíƒœ ì£¼ì… */}
      <CounterContext.Provider value={this.state}>
        <button onClick={this.handleClick}>+</button>
        <DummyParent />
      </CounterContext.Provider>
    )
  }
}
```

ê·¸ëŸ¬ë‚˜ Context APIëŠ” ìƒíƒœ ê´€ë¦¬ê°€ ì•„ë‹Œ ì£¼ì…ì„ ë„ì™€ì£¼ëŠ” ê¸°ëŠ¥ì´ë©°, ë Œë”ë§ì„ ë§‰ì•„ì£¼ëŠ” ê¸°ëŠ¥ ë˜í•œ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë‹ˆ ì‚¬ìš©ì— ì£¼ì˜í•´ì•¼ í•œë‹¤.


**í›…ì˜ íƒ„ìƒ, ê·¸ë¦¬ê³  React Queryì™€ SWR**

Context APIê°€ ì„ ë³´ì¸ ì§€ 1ë…„ì´ ì±„ ì§€ë‚˜ì§€ ì•Šì•„ ë¦¬ì•¡íŠ¸ëŠ” 16.8 ë²„ì „ì—ì„œ í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ í›… APIë¥¼ ì¶”ê°€í–ˆë‹¤.

í›…ê³¼ stateì˜ ë“±ì¥ìœ¼ë¡œ ì´ì „ì—ëŠ” ë³¼ ìˆ˜ ì—†ë˜ ë°©ì‹ì˜ ìƒíƒœ ê´€ë¦¬ì¸ React Queryì™€ SWRì´ ë“±ì¥í•œë‹¤.

ë‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” API í˜¸ì¶œì— ëŒ€í•œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” **HTTP ìš”ì²­ì— íŠ¹í™”ëœ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬**ì´ë‹¤.

SWRì„ ì‚¬ìš©í•œ ì½”ë“œë¥¼ ì‚´í´ë³´ì.

```jsx
import React from 'react'
import useSWR from 'swr'

const fetcher = (url) => fetch(url).then((res) => res.json())

export default function App() {
  const { data, error } = useSWR(
    'https://api.github.com/repos/vercel/swr',
    fetcher,
  )

  // ...
}
```

useSWRì˜ ì²« ë²ˆì§¸ ì¸ìˆ˜ë¡œ ì¡°íšŒí•  API ì£¼ì†Œë¥¼, ë‘ ë²ˆì§¸ ì¸ìˆ˜ë¡œ ì¡°íšŒì— ì‚¬ìš©ë˜ëŠ” fetchë¥¼ ë„˜ê²¨ì¤€ë‹¤.

ì²« ë²ˆì§¸ ì¸ìˆ˜ì¸ API ì£¼ì†ŒëŠ” í‚¤ë¡œë„ ì‚¬ìš©ë˜ë©°, ì´í›„ ë‹¤ë¥¸ ê³³ì—ì„œ ë™ì¼í•œ í‚¤ë¡œ í˜¸ì¶œí•˜ë©´ useSWRì´ ê´€ë¦¬í•˜ê³  ìˆëŠ” ìºì‹œì˜ ê°’ì„ í™œìš©í•œë‹¤.

ì œí•œì ì¸ ëª©ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ì§€ë§Œ, ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë§ì€ ë¶€ë¶„ì—ì„œ ìƒíƒœ ê´€ë¦¬ ì½”ë“œë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤.


**Recoil, Zustand, Jotai, Valtioì— ì´ë¥´ê¸°ê¹Œì§€**

```jsx
// Recoil
const counter = atom({ key: 'count', default: 0 })
const todoList = useRecoilValue(counter)

// Jotai
const countAtom = atom(0)
const [count, setCount] = useAtom(countAtom)

// Zustand
const useCounterStore = create((set) => ({
  count: 0,
  increase: () => set((state) => ({ count: state.count + 1})),
}))
const count = useCounterStore((state) => state.count)

// Valtio
const state = proxy({ count: 0 })
const snap = useSnapshot(state)
state.count++
```

ìƒˆë¡­ê²Œ ë– ì˜¤ë¥´ëŠ” ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ê¸°ì¡´ì˜ ë¦¬ë•ìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì°¨ì´ì ì€, í›…ì„ í™œìš©í•´ ì‘ì€ í¬ê¸°ì˜ ìƒíƒœë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤ëŠ” ê²ƒì´ë‹¤.

Recoil, Zustand, Jotai, ValtioëŠ” ëª¨ë‘ ì•„ë˜ì™€ ê°™ì€ íŠ¹ì§•ì„ ê°€ì§„ë‹¤.

- peerDependenciesë¡œ ë¦¬ì•¡íŠ¸ 16.8 ë²„ì „ ì´ìƒì„ ìš”êµ¬í•¨
- ë³„ë„ë¡œ ë‹¤ë¥¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•˜ì§€ ì•Šì•„ë„ ë¨
- ì§€ì—­ì  ìƒíƒœ ê´€ë¦¬ê°€ ê°€ëŠ¥
- í›…ì„ ì§€ì›í•¨ìœ¼ë¡œì¨ í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì†ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ


## 5.2 ë¦¬ì•¡íŠ¸ í›…ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ìƒíƒœ ê´€ë¦¬

ë¦¬ì•¡íŠ¸ 16.8ì—ì„œ ë“±ì¥í•œ í›…ê³¼ í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ì˜ íŒ¨ëŸ¬ë‹¤ì„ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ë¶€ ìƒíƒœ ê´€ë¦¬ë¥¼ ì–´ë–»ê²Œ í•  ìˆ˜ ìˆê³ , ì–´ë– í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìˆìœ¼ë©°, ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ ì•Œì•„ë³´ì.

### 5.2.1 ê°€ì¥ ê¸°ë³¸ì ì¸ ë°©ë²•: useStateì™€ useReducer

useStateì™€ useReducerë¡œ ë§Œë“  ì‚¬ìš©ì ì •ì˜ í›…ì€ í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ë¼ë©´ ì–´ë””ì„œë“  ì†ì‰½ê²Œ **ì¬ì‚¬ìš© ê°€ëŠ¥**í•˜ë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.

ê·¸ëŸ¬ë‚˜ useStateì™€ useReducerë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ëŠ” ì‚¬ìš©ì ì§€ì • í›…ì€ **ì§€ì—­ ìƒíƒœ**ë§Œ ë§Œë“¤ ìˆ˜ ìˆì–´ ìƒíƒœì˜ íŒŒí¸í™”ë¥¼ ë§Œë“¤ì–´ ë²„ë¦°ë‹¤ëŠ” í•œê³„ê°€ ìˆë‹¤.

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ë¥¼ ì¬ì„¤ê³„í•˜ëŠ” ë“±ì˜ ìˆ˜ê³ ë¡œì›€ì´ í•„ìš”í•˜ë‹¤.


### 5.2.2 ì§€ì—­ ìƒíƒœì˜ í•œê³„ë¥¼ ë²—ì–´ë‚˜ë³´ì: useStateì˜ ìƒíƒœë¥¼ ë°”ê¹¥ìœ¼ë¡œ ë¶„ë¦¬í•˜ê¸°

í•¨ìˆ˜ ì™¸ë¶€ì—ì„œ ìƒíƒœë¥¼ ì°¸ì¡°í•˜ê³  ì´ë¥¼ í†µí•´ ë Œë”ë§ì´ ì¼ì–´ë‚˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì¡°ê±´ì„ ë§Œì¡±í•´ì•¼ í•œë‹¤.

1. ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ ì–´ë”˜ê°€ì— ìƒíƒœë¥¼ ë‘ê³  ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ê°€ ê°™ì´ ì“¸ ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.
2. ì™¸ë¶€ì— ìˆëŠ” ìƒíƒœë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ëŠ” ìƒíƒœì˜ ë³€í™”ë¥¼ ì•Œì•„ì±Œ ìˆ˜ ìˆì–´ì•¼ í•˜ê³ , ìƒíƒœê°€ ë³€í™”ë  ë•Œë§ˆë‹¤ ë¦¬ë Œë”ë§ì´ ì¼ì–´ë‚˜ì„œ ì»´í¬ë„ŒíŠ¸ë¥¼ ìµœì‹  ìƒíƒœê°’ ê¸°ì¤€ìœ¼ë¡œ ë Œë”ë§í•´ì•¼ í•œë‹¤. ì´ ìƒíƒœ ê°ì§€ëŠ” ìƒíƒœë¥¼ ì°¸ì¡°í•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì—ì„œ ë™ì¼í•˜ê²Œ ì‘ë™í•´ì•¼ í•œë‹¤.
3. ìƒíƒœê°€ ì›ì‹œê°’ì´ ì•„ë‹Œ ê°ì²´ì¸ ê²½ìš°ì— ê·¸ ê°ì²´ì— ë‚´ê°€ ê°ì§€í•˜ëŠ” ê°’ì˜ ë³€í™”ì—ë§Œ ë¦¬ë Œë”ë§ ë˜ì–´ì•¼ í•œë‹¤.

ìƒíƒœì˜ ì´ë¦„ì„ storeë¡œ ì •ì˜í•˜ê³ , storeì˜ ê°’ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ ë³€ê²½ëìŒì„ ì•Œë¦¬ëŠ” callback í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤. ì´ callback í•¨ìˆ˜ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆëŠ” subscribe í•¨ìˆ˜ê°€ í•„ìš”í•˜ë‹¤.

```jsx
type Initializer<T> = T extends any ? T | ((prev: T) => T) : never

type Store<State> = {
  get: () => State
  set: (action: Initializer<State>) => State
  subscribe: (callback: () => void) => () => void
}

export const createStore = <State extends unknwon>(
  initialState: Initializer<State>,
): Store<State> => {
  // state ë˜ëŠ” ê²Œìœ¼ë¥¸ ì´ˆê¸°í™” í•¨ìˆ˜ë¡œ state ì´ˆê¹ƒê°’ í• ë‹¹
  let state = typeof initialState !== 'function' ? initialState : initialState()

  // ì½œë°± í•¨ìˆ˜ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ callbacks
  // ìë£Œí˜•ì— ê´€ê³„ì—†ì´ ìœ ì¼í•œ ê°’ì„ ì €ì¥í•  ìˆ˜ ìˆëŠ” Setìœ¼ë¡œ ì„ ì–¸
  const callbacks = new Set<() => void>()
  // getì´ í˜¸ì¶œë˜ë©´ ë§¤ë²ˆ ìµœì‹ ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê²Œ í•¨
  const get = () => state
  const set = (nextState: State | ((prev: State) => State)) => {
    // í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ì„œ ìƒˆë¡œìš´ ê°’ì„ ë°›ê±°ë‚˜ ìƒˆë¡œìš´ ê°’ì„ ê·¸ëŒ€ë¡œ ë„£ì–´ì¤Œ
    state =
      typeof nextState === 'function'
        ? (nextState as (prev: State) => State)(state)
        : nextState

    // setìœ¼ë¡œ ê°’ì„ ì„¤ì •í•˜ëŠ” ìˆœê°„ ì½œë°±ì„ ëª¨ë‘ ì‹¤í–‰í•´ ì»´í¬ë„ŒíŠ¸ì˜ ë Œë”ë§ ìœ ë„
    callbacks.forEach((callback) => callback())

    return state
  }

  const subscribe = (callback: () => void) => {
    // ë°›ì€ í•¨ìˆ˜ë¥¼ ì½œë°± ëª©ë¡ì— ì¶”ê°€
    callbacks.add(callback)

    return () => {
      callbacks.delete(callback)
    }
  }
  // get, set, subscribeì„ ì™¸ë¶€ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.
  return { get, set, subscribe }
}
```

useStore í›…ìœ¼ë¡œ storeì˜ ë³€í™”ë¥¼ ê°ì§€í•´ë³´ì.

```jsx
// storeë¥¼ ì¸ìˆ˜ë¡œ ë°›ìŒ
export const useStore = <State extends unknown>(store: Store<State>) => {
  // store ê°’ì„ ì´ˆê¹ƒê°’ìœ¼ë¡œ í•˜ëŠ” stateë¥¼ ë§Œë“¦
  // useStateê°€ ì»´í¬ë„ŒíŠ¸ì˜ ë Œë”ë§ì„ ìœ ë„í•¨
  const [state, setState] = useState<State>(() => store.get())

  useEffect(() => {
    // storeì˜ í˜„ì¬ ê°’ì„ ê°€ì ¸ì™€ setStateë¥¼ ìˆ˜í–‰í•˜ëŠ” í•¨ìˆ˜ë¥¼ storeì˜ subscribeì— ë“±ë¡
    // createStore ë‚´ë¶€ì—ì„œ ê°’ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ subscribeì— ë“±ë¡ëœ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë¯€ë¡œ
    // useStore ë‚´ë¶€ì—ì„œ storeì˜ ê°’ì´ ë³€ê²½ë  ë•Œ stateì˜ ê°’ì´ ë³€ê²½ë˜ëŠ” ê²ƒì´ ë³´ì¥ëœë‹¤.
    const unsubscribe = store.subscribe(() => {
      setState(store.get())
    })
    return unsubscribe
  }, [store])

  return [state, store.set] as const
}
```

storeê°€ ê°ì²´ì¼ ë•Œ, ì›í•˜ëŠ” ê°’ì´ ë³€í–ˆì„ ë•Œë§Œ ë¦¬ë Œë”ë§ë˜ë„ë¡ í›…ì„ ë‹¤ì‹œ êµ¬ì„±í•´ë³´ì.

```jsx
export const useStoreSelector = <State extends unknown, Value extends unknown>(
  store: Store<State>,
  selector: (state: State) => Value, // ğŸ“Œ ë‘ ë²ˆì§¸ ì¸ìˆ˜ë¡œ selector í•¨ìˆ˜ë¥¼ ë°›ëŠ”ë‹¤.
) => {
  const [state, setState] = useState<State>(() => selector(store.get()))

  useEffect(() => {
    const unsubscribe = store.subscribe(() => {
      // ğŸ“Œ store ê°’ì´ ë³€í•´ë„ selector(store.get())ì´ ë³€ê²½ë˜ì§€ ì•Šìœ¼ë©´ ë¦¬ë Œë”ë§ì´ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤.
      const value = selector(store.get())
      setState(value)
    })

    return unsubscribe
  }, [store, selector])

  return state
}
```

useStoreSelector í›…ì„ ì‚¬ìš©í•˜ëŠ” ì˜ˆì œë¥¼ ì‚´í´ë³´ì.

```jsx
const store = creatStore({ count: 0, text: 'hi' })

// ğŸ“Œ selectorë¥¼ ì»´í¬ë„ŒíŠ¸ ë°–ì—ì„œ ì„ ì–¸í•˜ê±°ë‚˜, useCallbackì„ ì‚¬ìš©í•´ ì°¸ì¡°ë¥¼ ê³ ì •ì‹œì¼œì•¼ í•œë‹¤.
// ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë  ë•Œë§ˆë‹¤ í•¨ìˆ˜ê°€ ê³„ì† ì¬ìƒì„±ë˜ì–´ storeì˜ subscribeë¥¼ ë°˜ë³µì ìœ¼ë¡œ ìˆ˜í–‰í•  ê²ƒì´ë‹¤.
const textSelector = (state: ReturnType<typeof store.get>) => state.text

function TextEditor() {
  const text = useStoreSelector(store, textSelector)

  function handleChange(e: ChangeEvent<HTMLInputElement>) {
    // ì»´í¬ë„ŒíŠ¸ì—ì„œ í•„ìš”í•œ ê°’ë§Œ selectí•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê³ 
    // select ë˜í•œ ì‹¤ì œë¡œ ê°ì²´ì—ì„œ ë³€ê²½ëœ ê°’ì— ëŒ€í•´ì„œë§Œ ìˆ˜í–‰í•  ê²ƒì´ë‹¤.
    store.set((prev) => ({ ...prev, text: e.target.value }))
  }

  return (
    <>
      <h3>{text}</h3>
      <input value={text} onChange={handleChange} />
    </>
  )
}
```

ë¦¬ì•¡íŠ¸ ì™¸ë¶€ì—ì„œ ê´€ë¦¬ë˜ëŠ” ê°’ì— ëŒ€í•œ ë³€ê²½ì„ ì¶”ì í•˜ê³ , ì´ë¥¼ ë¦¬ë Œë”ë§ê¹Œì§€ í•  ìˆ˜ ìˆëŠ” useStoreSelectorì™€ ê°™ì€ í›…ì´ ì´ë¯¸ ì¡´ì¬í•œë‹¤. ë¦¬ì•¡íŠ¸ íŒ€ì—ì„œ ë§Œë“  useSubscriptionì´ë‹¤.

```jsx
function NewCounter() {
  const subscription = useMemo(
    () => ({
      getCurrentValue: () => store.get(),
      subscribe: (callback: () => void) => {
        const unsubscribe = store.subscribe(callback)
        return () => unsubscribe()
      },
    }),
    [],
  )

  const value = useSubscription(subscription)

  return <>{JSON.stringify(value)}</>
}
```

useSubscriptionì˜ ì°¨ì´ì ì€ **selectorì™€ subscribeì— ëŒ€í•œ ë¹„êµ**ë„ ì¶”ê°€í–ˆë‹¤ëŠ” ê²ƒì´ë‹¤.

ìœ„ì—ì„œ ë§Œë“  useStoreë‚˜ useStoreSelector ëª¨ë‘ useEffectì˜ ì˜ì¡´ì„± ë°°ì—´ì— **storeë‚˜ selectorê°€** ë“¤ì–´ê°€ ìˆì–´ ì´ ê°ì²´ê°€ **ì„ì˜ë¡œ ë³€ê²½ë  ê²½ìš°** ë¶ˆí•„ìš”í•˜ê²Œ ë¦¬ë Œë”ë§ì´ ë°œìƒí•œë‹¤ëŠ” ë¬¸ì œê°€ ìˆë‹¤.

ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ useSubscription ë‚´ë¶€ì—ëŠ” **ì˜ˆì™¸ ì²˜ë¦¬ê°€ ì¶”ê°€**ë˜ì–´ ë” ì•ˆì •ì ìœ¼ë¡œ ìƒíƒœë¥¼ ì œê³µí•  ìˆ˜ ìˆë‹¤.

> ë¦¬ì•¡íŠ¸ 18 ë²„ì „ì˜ useSubscriptionì„ ì‚´í´ë³´ë©´ useSubscription í›… ìì²´ê°€ useSyncExternalStoreë¡œ ì¬ì‘ì„±ë˜ì–´ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. ì´ì— ëŒ€í•´ì„œëŠ” 10.2ì ˆ 'ë¦¬ì•¡íŠ¸ 18 ë²„ì „ ì‚´í´ë³´ê¸°'ì—ì„œ ë‹¤ë£¬ë‹¤.


### 5.2.3 useStateì™€ Contextë¥¼ ë™ì‹œì— ì‚¬ìš©í•´ ë³´ê¸°

ì•ì„œ ë§Œë“  useStoreì™€ useStoreSelector í›…ì€ ë°˜ë“œì‹œ í•˜ë‚˜ì˜ ìŠ¤í† ì–´ë§Œ ê°€ì§€ê²Œ ëœë‹¤ëŠ” ë‹¨ì ì´ ìˆë‹¤.

**Context**ë¥¼ í™œìš©í•´ í•´ë‹¹ **ìŠ¤í† ì–´ë¥¼ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì— ì£¼ì…**í•œë‹¤ë©´ ë™ì¼í•œ êµ¬ì¡°ì˜ ìŠ¤í† ì–´ë¥¼ ì„œë¡œ ë‹¤ë¥¸ ìŠ¤ì½”í”„ì—ì„œ ì„œë¡œ ë‹¤ë¥¸ ë°ì´í„°ë¥¼ ê³µìœ í•´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```jsx
// Storeë¥¼ ìƒì„±í•˜ëŠ” Context ì •ì˜
export const CounterStoreContext = createContext<Store<CounterStore>>(
  createStore<CounterStore>({ count: 0, text: 'hi' }),
)

export const CounterStoreProvider = ({
  initialState,
  children,
): PropsWithChildren<{
  initialState: CounterStore
}>) => {
  // Providerë¡œ ë„˜ê¸°ëŠ” propsê°€ ë¶ˆí•„ìš”í•˜ê²Œ ë³€ê²½ë˜ì–´ ë¦¬ë Œë”ë§ë˜ëŠ” ê²ƒì„ ë§‰ê¸° ìœ„í•´ refë¡œ ì œê³µ
  const storeRef = useRef<Store<CounterStore>>()

  if (!storeRef.current) {
    storeRef.current = createStore(initialState)
  }

  return (
    <CounterStoreContext.Provider value={storeRef.current}>
      {children}
    </CounterStoreContext.Provider>
  )
}
```

ì´ Contextì—ì„œ ë‚´ë ¤ì£¼ëŠ” ê°’ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ìƒˆë¡œìš´ í›…ì´ í•„ìš”í•˜ë‹¤.

```jsx
export const useCounterContextSelector = <State extends unknown>(
  selector: (state: CounterStore) => State,
) => {
  // useContextë¡œ storeì— ì ‘ê·¼
  const store = useContext(CounterStoreContext)
  const subscription = useSubscription(
    useMemo(
      () => ({
        getCurrentValue: () => selector(store.get()),
        subscribe: store.subscribe,
      }),
      [store, selector],
    ),
  )

  return [subscription, store.set] as const
}
```

ì´ ìƒˆë¡œìš´ í›…ê³¼ Contextë¥¼ ì‚¬ìš©í•˜ëŠ” ì˜ˆì œë¥¼ ì‚´í´ë³´ì.

```jsx
const ContextCounter = () => {
  const id = useId()
  const [counter, setStore] = useCouterContextSelector(
    useCallback((state: CounterStore) => state.count, []),
  )

  function handleClick() {
    setStore((prev) => ({ ...prev, count: prev.count + 1 }))
  }

  return (
    <div>
      {counter} <button onClick={handleClick}>+</button>
    </div>
  )
}

const ContextInput = () => {
  const id = useId()
  const [text, setStore] = useCounterContextSelector(
    useCallback((state: CounterStore) => state.text, []),
  )

  function handleChange() {
    setStore((prev) => ({ ...prev, text: e.target.value }))
  }

  return (
    <div>
      <input value={text} onChange={handleChange} />
    </div>
  )
}
```

```jsx
export default function App() {
  return (
    <>
      {/* Providerê°€ ì—†ê¸° ë•Œë¬¸ì— ì „ì—­ì— ìƒì„±ëœ ìŠ¤í† ì–´ë¥¼ ë°”ë¼ë´ì„œ CounterStoreContextì˜ ì´ˆê¹ƒê°’ì´ ì‚¬ìš©ë¨ */}
      {/* 0 */}
      <ContextCounter />
      {/* hi */} 
      <ContextInput />
      <CounterStoreProvider initialState={{ count: 10, text: 'hello' }}>
        {/* 10 */}
        <ContextCounter />
        {/* hello */}
        <ContextInput />
        <CounterStoreProvider initialState={{ count: 20, text: 'welcome' }}>
          {/* ê°€ì¥ ê°€ê¹Œìš´ Providerë¥¼ ì°¸ì¡° */}
          {/* 20 */}
          <ContextCounter />
          {/* welcome */}
          <ContextInput />
        </CounterStoreProvider>
      </CounterStoreProvider>
    </>
  )
}
```

ì´ë ‡ê²Œ Contextì™€ Providerë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê° store ê°’ì„ ê²©ë¦¬í•´ì„œ ê´€ë¦¬í•˜ë©´

1. ìŠ¤í† ì–´ë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ëŠ” í•´ë‹¹ ìƒíƒœê°€ ì–´ëŠ ìŠ¤í† ì–´ì—ì„œ ì˜¨ ìƒíƒœì¸ì§€ ì‹ ê²½ì“°ì§€ ì•Šì•„ë„ ëœë‹¤.
2. Contextì™€ Providerë¥¼ ê´€ë¦¬í•˜ëŠ” ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ëŠ” ìì‹ ì´ ìì‹ ì»´í¬ë„ŒíŠ¸ì— ë”°ë¼ ë³´ì—¬ì£¼ê³  ì‹¶ì€ ë°ì´í„°ë¥¼ Contextë¡œ ì˜ ê²©ë¦¬í•˜ê¸°ë§Œ í•˜ë©´ ëœë‹¤.

ì¦‰, ë¶€ëª¨ì™€ ìì‹ ì»´í¬ë„ŒíŠ¸ì˜ ì±…ì„ê³¼ ì—­í• ì„ ëª…ì‹œì ì¸ ì½”ë“œë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆì–´ ì½”ë“œ ì‘ì„±ì´ ìš©ì´í•´ì§„ë‹¤.

ë¦¬ì•¡íŠ¸ì˜ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì‘ë™í•˜ëŠ” ë°©ì‹ì€ ë‹¤ìŒê³¼ ê°™ì´ ìš”ì•½í•  ìˆ˜ ìˆë‹¤.

- useState, useReducerê°€ ê°€ì§€ê³  ìˆëŠ” í•œê³„, ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì§€ì—­ ìƒíƒœë¼ëŠ” ì ì„ ê·¹ë³µí•˜ê¸° ìœ„í•´ ì™¸ë¶€ ì–´ë”˜ê°€ì— ìƒíƒœë¥¼ ë‘”ë‹¤.
- ì´ ì™¸ë¶€ì˜ ìƒíƒœ ë³€ê²½ì„ ê°ìì˜ ë°©ì‹ìœ¼ë¡œ ê°ì§€í•´ ì»´í¬ë„ŒíŠ¸ì˜ ë Œë”ë§ì„ ì¼ìœ¼í‚¨ë‹¤.


### 5.2.4 ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ Recoil, Jotai, Zustand ì‚´í´ë³´ê¸°

- ì„¸ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì§€í–¥í•˜ëŠ” ëª©ì 
- ë¼ì´ë¸ŒëŸ¬ë¦¬ ë‚´ë¶€ì—ì„œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ë²•
- ê° ì»´í¬ë„ŒíŠ¸ë¡œ ìƒíƒœë¥¼ ì „íŒŒí•´ ë Œë”ë§ì„ ì¼ìœ¼í‚¤ëŠ” ë°©ë²•

ì— ëŒ€í•´ ì‚´í´ë³´ì.


**í˜ì´ìŠ¤ë¶ì´ ë§Œë“  ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ Recoil**

Recoilì€ ë¦¬ì•¡íŠ¸ì—ì„œ **í›…ì˜ ê°œë…**ìœ¼ë¡œ ìƒíƒœ ê´€ë¦¬ë¥¼ ì‹œì‘í•œ ìµœì´ˆì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¤‘ í•˜ë‚˜ì´ë©°, ìµœì†Œ ìƒíƒœ ê°œë…ì¸ **Atom**ì„ ì²˜ìŒ ë¦¬ì•¡íŠ¸ ìƒíƒœê³„ì— ì„ ë³´ì´ê¸°ë„ í–ˆë‹¤.

ê·¸ëŸ¬ë‚˜ ì•„ì§ ì •ì‹ìœ¼ë¡œ ì¶œì‹œí•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì•„ë‹ˆë¼ ì‹¤ì œ í”„ë¡œë•ì…˜ì— ì‚¬ìš©í•˜ê¸°ì—ëŠ” ì•ˆì •ì„±ì´ë‚˜ ì„±ëŠ¥, ì‚¬ìš©ì„± ë“±ì„ ë³´ì¥í•  ìˆ˜ ì—†ë‹¤.

Recoilì˜ í•µì‹¬ APIì¸ RecoilRoot, atom, useRecoilValue, useRecoilStateë¥¼ ì‚´í´ë³´ê³ , Recoilì—ì„œëŠ” **ìƒíƒœê°’ì„ ì–´ë””ì— ì–´ë–»ê²Œ ì €ì¥**í•˜ê³ , **ì»´í¬ë„ŒíŠ¸ì˜ ë Œë”ë§ì€ ì–´ë–»ê²Œ ë°œìƒ**ì‹œí‚¤ëŠ”ì§€ ê·¸ ì›ë¦¬ë¥¼ ì•Œì•„ë³´ì. (Recoil 0.7.5 ê¸°ì¤€)

> RecoilRoot

Recoilì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” RecoilRootë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ìµœìƒë‹¨ì— ì„ ì–¸í•´ ë‘¬ì•¼ í•œë‹¤.

```jsx
export default function AppRoot() {
  return (
    <RecoilRoot>{/* some components */}</RecoilRoot>
  );
}
```

ì™œì¼ê¹Œ?

```jsx
function RecoilRoot(props: Props): React.Node {
  const {override, ...propsExceptOverride} = props;

  // ğŸ“Œ useStoreRefë¡œ ancestorStoreRefì˜ ì¡´ì¬ë¥¼ í™•ì¸
  // ancestorStoreRef: Recoilì—ì„œ ìƒì„±ë˜ëŠ” atomê³¼ ê°™ì€ ìƒíƒœê°’ì„ ì €ì¥í•˜ëŠ” ìŠ¤í† ì–´
  // useStoreRef: AppContextê°€ ê°€ì§€ê³  ìˆëŠ” ìŠ¤í† ì–´ë¥¼ ê°€ë¦¬í‚´
  const ancestorStoreRef = useStoreRef();
  if (override === false && ancestorStoreRef.current !== defaultStore) {
    // If ancestorStoreRef.current !== defaultStore, it means that this
    // RecoilRoot is not nested within another.
    return props.children;
  }

  return <RecoilRoot_INTERNAL {...propsExceptOverride} />;
}
```

```jsx
const AppContext = React.createContext<StoreRef>({ current: defaultStore });
const useStoreRef = (): StoreRef => useContext(AppContext);
```

ìŠ¤í† ì–´ì˜ ê¸°ë³¸ê°’ì„ ì˜ë¯¸í•˜ëŠ” defaultStoreëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```jsx
function notInAContext() {
  throw err('This component must be used inside a <RecoilRoot> component.');
}

const defaultStore: Store = Object.freeze({
  storeID: getNextStoreID(),  // storeì˜ id ê°’ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
  getState: notInAContext,    // storeì˜ ê°’ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
  replaceState: notInAContext,// ê°’ì„ ìˆ˜ì •í•˜ëŠ” í•¨ìˆ˜
  getGraph: notInAContext,
  subscribeToTransactions: notInAContext,
  addTransactionMetadata: notInAContext,
});
```

**ìŠ¤í† ì–´ ì•„ì´ë””ë¥¼ ì œì™¸í•˜ê³ ëŠ” ëª¨ë‘ ì—ëŸ¬ë¡œ ì²˜ë¦¬**ë˜ì–´ ìˆëŠ” ê²ƒì„ ë³´ì•„, RecoilRootë¡œ ê°ì‹¸ì§€ ì•Šì€ ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” ìŠ¤í† ì–´ì— ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

ê°’ì„ ìˆ˜ì •í•˜ëŠ” í•¨ìˆ˜ì¸ replaceStateë¥¼ ì‚´í´ë³´ì.

```jsx
const replaceState = (replacer: TreeState => TreeState) => {
  startNextTreeIfNeeded(storeRef.current);
  // Use replacer to get the next state:
  const nextTree = nullthrows(storeStateRef.current.nextTree);
  let replaced;
  try {
    stateReplacerIsBeingExecuted = true;
    replaced = replacer(nextTree);
  } finally {
    stateReplacerIsBeingExecuted = false;
  }
  if (replaced === nextTree) {
    return;
  }

  // ...

  // Save changes to nextTree and schedule a React update:
  storeStateRef.current.nextTree = replaced;
  if (reactMode().early) {
    // ğŸ“Œ ìƒíƒœê°€ ë³€í•  ë•Œ ë³€ê²½ëœ ìƒíƒœë¥¼ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ë¡œ ì „íŒŒí•´ ë¦¬ë Œë”ë§ì„ ì¼ìœ¼í‚¤ëŠ” notifyComponentsê°€ ìˆë‹¤.
    notifyComponents(storeRef.current, storeStateRef.current, replaced);
  }
  // ...
}
```

notifyComponentsì˜ êµ¬ì¡°ë„ ì‚´í´ë³´ì.

```jsx
function notifyComponents(
  // ğŸ“Œ storeì™€ ìƒíƒœë¥¼ ì „íŒŒí•  storeStateë¥¼ ì¸ìˆ˜ë¡œ ë°›ìŒ
  store: Store,
  storeState: StoreState,
  treeState: TreeState,
): void {
  // ğŸ“Œ ì´ ìŠ¤í† ì–´ë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” í•˜ìœ„ ì˜ì¡´ì„±ì„ ëª¨ë‘ ê²€ìƒ‰
  const dependentNodes = getDownstreamNodes(
    store,
    treeState,
    treeState.dirtyAtoms,
  );
  for (const key of dependentNodes) {
    const comps = storeState.nodeToComponentSubscriptions.get(key);
    // ğŸ“Œ í•˜ìœ„ ì˜ì¡´ì„±ì— ìˆëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì„ ëª¨ë‘ í™•ì¸í•´ ì½œë°± ì‹¤í–‰
    if (comps) {
      for (const [_subID, [_debugName, callback]] of comps) {
        callback(treeState);
      }
    }
  }
}
```

ì¦‰ RecoilRootì˜ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

- Recoilì˜ ìƒíƒœê°’ì€ RecoilRootë¡œ ìƒì„±ëœ Contextì˜ ìŠ¤í† ì–´ì— ì €ì¥ëœë‹¤.
- ìŠ¤í† ì–´ì˜ ìƒíƒœê°’ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ë“¤ì´ ìˆìœ¼ë©°, ì´ í•¨ìˆ˜ë¥¼ í™œìš©í•´ ìƒíƒœì— ì ‘ê·¼í•˜ê±°ë‚˜ ìƒíƒœê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.
- ê°’ì˜ ë³€ê²½ì´ ë°œìƒí•˜ë©´ ì´ë¥¼ ì°¸ì¡°í•˜ê³  ìˆëŠ” í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì— ëª¨ë‘ ì•Œë¦°ë‹¤.

> atom

atomì€ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ” **Recoilì˜ ìµœì†Œ ìƒíƒœ ë‹¨ìœ„**ë‹¤.

atomì€ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ë¡œ ì„ ì–¸í•  ìˆ˜ ìˆë‹¤.

```jsx
// Atom ì„ ì–¸
const counter = atom({
  key: 'myCounter',
  default: 0,
});
```

atomì€ key ê°’ì„ í•„ìˆ˜ë¡œ ê°€ì§€ë©°, ì´ í‚¤ëŠ” ë‹¤ë¥¸ atomê³¼ êµ¬ë³„í•˜ëŠ” ì‹ë³„ìê°€ ëœë‹¤.

atomì˜ ê°’ì„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì½ì–´ì˜¤ê³  ì´ ê°’ì˜ ë³€í™”ì— ë”°ë¼ ì»´í¬ë„ŒíŠ¸ë¥¼ ë¦¬ë Œë”ë§ í•˜ë ¤ë©´ useRecoilValue, useRecoilState ë‘ ê°€ì§€ í›…ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

> useRecoilValue

useRecoilValueëŠ” atomì˜ ê°’ì„ ì½ì–´ì˜¤ëŠ” í›…ì´ë‹¤. ë‹¤ìŒê³¼ ê°™ì´ atomì˜ ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

```jsx
const namesState = atom({
  key: 'namesState',
  default: ['', 'Ella', 'Chris', '', 'Paul'],
});

function NameDisplay() {
  const names = useRecoilValue(namesState);

  return (
    <>{/* something... */}</>
  );
}
```

ì´ useRecoilValue í›…ì€ ì–´ë–»ê²Œ êµ¬í˜„ë¼ ìˆëŠ”ì§€ ì‚´í´ë³´ì.

```jsx
// useRecoilValue
function useRecoilValue<T>(recoilValue: RecoilValue<T>): T {
  if (__DEV__) {
    validateRecoilValue(recoilValue, 'useRecoilValue');
  }
  const loadable = useRecoilValueLoadable(recoilValue);
  return handleLoadable(loadable, recoilValue, storeRef);
}

// useRecoilValueLoadable
function useRecoilValueLoadable_LEGACY<T>(
  recoilValue: RecoilValue<T>,
): Loadable<T> {
  const storeRef = useStoreRef();
  const [, forceUpdate] = useState(([]: Array<$FlowFixMe>));
  const componentName = useComponentName();

  const getLoadable = useCallback(() => {
    if (__DEV__) {
      recoilComponentGetRecoilValueCount_FOR_TESTING.current++;
    }
    const store = storeRef.current;
    const storeState = store.getState();
    const treeState = reactMode().early
      ? storeState.nextTree ?? storeState.currentTree
      : storeState.currentTree;
    
    return getRecoilValueAsLoadable(store, recoilValue, treeState);
  }, [storeRef, recoilValue]);
  // ğŸ“Œ í˜„ì¬ Recoilì´ ê°€ì§€ê³  ìˆëŠ” ìƒíƒœê°’ì„ ê°€ì§€ê³  ìˆëŠ” í´ë˜ìŠ¤ì¸ loadableì„ ë°˜í™˜
  const loadable = getLoadable();
  // ğŸ“Œ loadableì„ ì´ì „ê°’ê³¼ ë¹„êµí•´ ë Œë”ë§ì´ í•„ìš”í•œì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ë Œë”ë§ì„ ì¼ìœ¼í‚¤ì§€ ì•Šìœ¼ë©´ì„œ ê°’ì„ ì €ì¥í•  ìˆ˜ ìˆëŠ” refì— ì €ì¥
  const prevLoadableRef = useRef(loadable);
  useEffect(() => {
    prevLoadableRef.current = loadable;
  });

  useEffect(() => {
    const store = storeRef.current;
    const storeState = store.getState();
    const subscription = subscribeToRecoilValue(
      store,
      recoilValue,
      _state => {
        if (!gkx('recoil_suppress_rerender_in_callback')) {
          return forceUpdate([]);
        }
        const newLoadable = getLoadable();
        // ğŸ“Œ recoilValueê°€ ë³€ê²½ëì„ ë•Œ forceUpdateë¥¼ í˜¸ì¶œí•´ ë Œë”ë§ì„ ê°•ì œë¡œ ì¼ìœ¼í‚´
        // ğŸ“Œ 'ì™¸ë¶€ì˜ ê°’ì„ êµ¬ë…í•´ ë Œë”ë§ì„ ê°•ì œë¡œ ì¼ìœ¼í‚¨ë‹¤'ë¼ëŠ” ì›ë¦¬ëŠ” ì´ì „ ì˜ˆì œì™€ ë™ì¼í•œ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŒ
        if (!prevLoadableRef.current?.is(newLoadable)) {
          // $FlowFixMe[incompatible-call]
          forceUpdate(newLoadable);
        }
        prevLoadableRef.current = newLoadable;
      },
      componentName,
    );

    if (storeState.nextTree) {
      store.getState().queuedComponentCallbacks_DEPRECATED.push(() => {
        // $FlowFixMe[incompatible-type]
        prevLoadableRef.current = null;
        forceUpdate([]);
      });
    } else {
      if (!gkx('recoil_suppress_rerender_in_callback')) {
        return forceUpdate([]);
      }
      const newLoadable = getLoadable();
      if (!prevLoadableRef.current?.is(newLoadable)) {
        // $FlowFixMe[incompatible-call]
        forceUpdate(newLoadable);
      }
      prevLoadableRef.current = newLoadable;
    }

    return subscription.release;
  }, [componentName, getLoadable, recoilValue, storeRef]);

  return loadable;
}
```

> useRecoilState

useRecoilStateëŠ” useStateì™€ ìœ ì‚¬í•˜ê²Œ ê°’ì„ ê°€ì ¸ì˜¤ê³ , ë˜ ì´ ê°’ì„ ë³€ê²½í•  ìˆ˜ë„ ìˆëŠ” í›…ì´ë‹¤. useRecoilStateë¥¼ ì‚´í´ë³´ì.

```jsx
function useRecoilState<T>(
  recoilState: RecoilState<T>,
): [T, SetterOrUpdater<T>] {
  if (__DEV__) {
    validateRecoilValue(recoilState, 'useRecoilState');
  }
  // í˜„ì¬ ê°’ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ useRecoilValueë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©
  // ìƒíƒœë¥¼ ì„¤ì •í•˜ëŠ” í›…ìœ¼ë¡œ useSetRecoilState ì‚¬ìš©
  return [useRecoilValue(recoilState), useSetRecoilState(recoilState)];
}
```

```jsx
// useSetRecoilState
/**
  Returns a function that allows the value of a RecoilState to be updated, but does
  not subscribe the component to changes to that RecoilState.
*/
function useSetRecoilState<T>(recoilState: RecoilState<T>): SetterOrUpdater<T> {
  if (__DEV__) {
    validateRecoilValue(recoilState, 'useSetRecoilState');
  }
  // ë‚´ë¶€ì—ì„œ ë¨¼ì € ìŠ¤í† ì–´ë¥¼ ê°€ì ¸ì˜¨ í›„ setRecoilValueë¥¼ í˜¸ì¶œí•´ ê°’ì„ ì—…ë°ì´íŠ¸í•˜ê³  ìˆë‹¤.
  const storeRef = useStoreRef();
  return useCallback(
    (newValueOrUpdater: (T => T | DefaultValue) | T | DefaultValue) => {
      setRecoilValue(storeRef.current, recoilState, newValueOrUpdater);
    },
    [storeRef, recoilState],
  );
}
```

```jsx
// setRecoilValue
function setRecoilValue<T>(
  store: Store,
  recoilValue: AbstractRecoilValue<T>,
  valueOrUpdater: T | DefaultValue | (T => T | DefaultValue),
): void {
  // queueOrPerformStateUpdate í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸ê°€ í•„ìš”í•œ ë‚´ìš©ì„ ë“±ë¡í•¨
  queueOrPerformStateUpdate(store, {
    type: 'set',
    recoilValue,
    valueOrUpdater,
  });
}
```

ì§€ê¸ˆê¹Œì§€ ì‚´í´ë³¸ ë‚´ìš©ì„ ì¢…í•©í•˜ë©´

1. ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìµœìƒë‹¨ì— `<RecoilRoot />`ë¥¼ ì„ ì–¸í•´ í•˜ë‚˜ì˜ ìŠ¤í† ì–´ë¥¼ ë§Œë“ ë‹¤.
2. atomì´ë¼ëŠ” ìƒíƒœ ë‹¨ìœ„ë¥¼ `<RecoilRoot />`ì—ì„œ ë§Œë“  ìŠ¤í† ì–´ì— ë“±ë¡í•œë‹¤. (atomì€ ì‹ë³„ìì¸ keyë¡œ êµ¬ë³„ëœë‹¤.)
3. Recoilì—ì„œ ì œê³µë˜ëŠ” í›…ì„ í†µí•´ atomì˜ ìƒíƒœ ë³€í™”ë¥¼ êµ¬ë…(subscribe)í•˜ê³ , ê°’ì´ ë³€ê²½ë˜ë©´ forceUpdate ê°™ì€ ê¸°ë²•ì„ í†µí•´ ë¦¬ë Œë”ë§ì„ ì‹¤í–‰í•´ ìµœì‹  atom ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.


> ê°„ë‹¨í•œ ì‚¬ìš©ë²•

```jsx
const tempFahrenheit = atom({
  key: 'tempFahrenheit',
  default: 32,
});

// atomì„ ê¸°ë°˜ìœ¼ë¡œ ë˜ ë‹¤ë¥¸ ìƒíƒœë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
const tempCelsius = selector({
  key: 'tempCelsius',
  get: ({get}) => ((get(tempFahrenheit) - 32) * 5) / 9,
  set: ({set}, newValue) => set(tempFahrenheit, (newValue * 9) / 5 + 32),
});

function TempCelsius() {
  const [tempF, setTempF] = useRecoilState(tempFahrenheit);
  const [tempC, setTempC] = useRecoilState(tempCelsius);

  const addTenCelsius = () => setTempC(tempC + 10);
  const addTenFahrenheit = () => setTempF(tempF + 10);

  return (
    <div>
      Temp (Celsius): {tempC}
      <br />
      Temp (Fahrenheit): {tempF}
      <br />
      <button onClick={addTenCelsius}>Add 10 Celsius</button>
      <br />
      <button onClick={addTenFahrenheit}>Add 10 Fahrenheit</button>
    </div>
  );
}

export default function App() {
  return (
    <RecoilRoot>
      <TempCelsius />
    </RecoilRoot>
  )
}
```

ì•ì„œ ì„¤ëª…í•œ API ì™¸ì— í•œ ê°œ ì´ìƒì˜ atom ê°’ì„ ë°”íƒ•ìœ¼ë¡œ ìƒˆë¡œìš´ ê°’ì„ ì¡°ë¦½í•  ìˆ˜ ìˆëŠ” selectorë¼ëŠ” í•¨ìˆ˜ê°€ ì‚¬ìš©ë˜ì—ˆë‹¤. ì´ ì™¸ì—ë„ atomì— ë¹„ë™ê¸° ì‘ì—…ë„ ì¶”ê°€í•  ìˆ˜ ìˆìœ¼ë©°, useRecoilStateLoadable, waitForAll, waitForAny, waitForAllSettledì™€ ê°™ì´ ê°•ë ¥í•œ ë¹„ë™ê¸° ì‘ì—…ì„ ì§€ì›í•˜ê¸° ìœ„í•œ APIë„ ì§€ì›í•œë‹¤.

> íŠ¹ì§•

- ë©”íƒ€ íŒ€ì—ì„œ ì£¼ë„ì ìœ¼ë¡œ ê°œë°œí•˜ê³  ìˆê¸° ë•Œë¬¸ì— ë¦¬ì•¡íŠ¸ì˜ ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì˜ ì§€ì›í•  ê²ƒìœ¼ë¡œ ê¸°ëŒ€ëœë‹¤.
- selectorë¥¼ í•„ë‘ë¡œ ë‹¤ì–‘í•œ ë¹„ë™ê¸° ì‘ì—…ì„ ì§€ì›í•˜ëŠ” APIë¥¼ ì œê³µí•˜ê³  ìˆê¸° ë•Œë¬¸ì— ì¶”ê°€ì ì¸ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šë”ë¼ë„ ë¹„ë™ê¸° ì‘ì—…ì„ ìˆ˜ì›”í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.
- ìì²´ì ì¸ ê°œë°œ ë„êµ¬ë¥¼ ì§€ì›í•´ Recoilì„ ê¸°ë°˜ìœ¼ë¡œ ê°œë°œí•˜ëŠ”ë° ë§ì€ ë„ì›€ì„ ì–»ì„ ìˆ˜ ìˆë‹¤.

ê·¸ëŸ¬ë‚˜ ì•ì„œ ì–¸ê¸‰í–ˆë“¯ì´ Recoilì€ ì•„ì§ ì •ì‹ ë²„ì „ì´ ì¶œì‹œë˜ì§€ ì•Šì•„ ì•ˆì •ì„±ì´ ë³´ì¥ë˜ì§€ ì•ŠëŠ”ë‹¤.


**Recoilì—ì„œ ì˜ê°ì„ ë°›ì€, ê·¸ëŸ¬ë‚˜ ì¡°ê¸ˆ ë” ìœ ì—°í•œ Jotai**

JotaiëŠ” Recoilì˜ atom ëª¨ë¸ì— ì˜ê°ì„ ë°›ì•„ ë§Œë“¤ì–´ì§„ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.

- ìƒí–¥ì‹(bottom-up) ì ‘ê·¼ë²•ì„ ì·¨í•˜ê³  ìˆë‹¤. ì‘ì€ ë‹¨ìœ„ì˜ ìƒíƒœë¥¼ ìœ„ë¡œ ì „íŒŒí•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¥¼ ì˜ë¯¸í•œë‹¤.
- ê°œë°œìë“¤ì´ ë©”ëª¨ì´ì œì´ì…˜ì´ë‚˜ ìµœì í™”ë¥¼ ê±°ì¹˜ì§€ ì•Šì•„ë„ ë¦¬ë Œë”ë§ì´ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ì„¤ê³„ë¼ ìˆë‹¤.

> atom

Jotaiì—ë„ Recoilê³¼ ê°™ì´ atom ê°œë…ì´ ì¡´ì¬í•œë‹¤. ê·¸ëŸ¬ë‚˜ Recoilê³¼ëŠ” ë‹¤ë¥´ê²Œ, atom í•˜ë‚˜ë§Œìœ¼ë¡œ ìƒíƒœë¥¼ ë§Œë“¤ ìˆ˜ ìˆê³ , ì´ì— íŒŒìƒëœ ìƒíƒœë¥¼ ë§Œë“¤ ìˆ˜ë„ ìˆë‹¤.

```jsx
const counterAtom = atom(0)

// atomì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì •ë³´ê°€ ë‹´ê¸´ë‹¤.
console.log(counterAtom)
// ...
// {
//  init: 0,
//  read: (get) => get(config),
//  write: (get, set, update) =>
//    set(config, typeof update === 'function' ? update(get(config)) : update)
//}
```

Jotaiì˜ ë‚´ë¶€ atom êµ¬í˜„ì„ ë³´ê³  atomì˜ êµ¬ì¡°ë¥¼ ì‚´í´ë³´ì.

```jsx
export function atom<Value, Args extends unknown[], Result>(
  read: Value | Read<Value, SetAtom<Args, Result>>,
  write?: Write<Args, Result>,
) {
  // JotaiëŠ” ì™¸ë¶€ì—ì„œ ë³„ë„ì˜ keyë¥¼ ë„˜ê²¨ì£¼ì§€ ì•Šì•„ë„ ëœë‹¤.
  const key = `atom${++keyCount}`
  // configì—ëŠ” ì´ˆê¹ƒê°’ init, ê°’ì„ ê°€ì ¸ì˜¤ëŠ” read, ê°’ì„ ì„¤ì •í•˜ëŠ” writeë§Œ ì¡´ì¬í•œë‹¤.
  const config = {
    toString: () => key,
  } as WritableAtom<Value, Args, Result> & { init?: Value }
  if (typeof read === 'function') {
    config.read = read as Read<Value, SetAtom<Args, Result>>
  } else {
    config.init = read
    config.read = defaultRead
    config.write = defaultWrite as unknown as Write<Args, Result>
  }
  if (write) {
    config.write = write
  }
  return config
}
```

Jotaiì—ì„œì˜ atomì€ ë”°ë¡œ ìƒíƒœë¥¼ ì €ì¥í•˜ê³  ìˆì§€ ì•Šë‹¤. ê·¸ë ‡ë‹¤ë©´ ìƒíƒœë¥¼ ì–´ë””ì— ì €ì¥í•´ ë‘ëŠ” ê²ƒì¼ì§€ useAtomValueë¥¼ ì‚´í´ë³´ì.

```jsx
export function useAtomValue<Value>(
  atom: Atom<Value>,
  options?: Options,
): Awaited<Value> {
  const store = useStore(options)

  // ğŸ“Œ JotaiëŠ” WeakMap ë°©ì‹ìœ¼ë¡œ ê°’ì„ ì €ì¥í•˜ê¸° ë•Œë¬¸ì— ë³„ë„ì˜ keyë¥¼ ë°›ì§€ ì•Šì•„ë„ ìŠ¤í† ì–´ì— ê°’ì„ ì €ì¥í•  ìˆ˜ ìˆë‹¤.
  // (WeakMap: storeì— atom ê°ì²´ ê·¸ ìì²´ë¥¼ keyë¡œ í™œìš©í•´ì„œ ê°’ì„ ì €ì¥í•˜ëŠ” ë°©ì‹)
  const [[valueFromReducer, storeFromReducer, atomFromReducer], rerender] =
    useReducer<
      ReducerWithoutAction<readonly [Value, Store, typeof atom]>,
      undefined
    >(
      (prev) => {
        const nextValue = store.get(atom)
        if (
          Object.is(prev[0], nextValue) &&
          prev[1] === store &&
          prev[2] === atom
        ) {
          return prev
        }
        return [nextValue, store, atom]
      },
      undefined,
      () => [store.get(atom), store, atom],
    )

  // ğŸ“Œ ë¦¬ë Œë”ë§ì„ ì¼ìœ¼í‚¤ëŠ” rerender()ê°€ ì¼ì–´ë‚˜ëŠ” ê²½ìš°ëŠ” ë‘ ê°€ì§€ê°€ ìˆë‹¤.
  let value = valueFromReducer
  if (storeFromReducer !== store || atomFromReducer !== atom) {
    // 1. ë„˜ê²¨ ë°›ì€ atomì´ Reducerë¥¼ í†µí•´ ìŠ¤í† ì–´ì— ìˆëŠ” atomê³¼ ë‹¬ë¼ì§€ëŠ” ê²½ìš°
    rerender()
    value = store.get(atom)
  }

  const delay = options?.delay
  // 2. subscribeì„ ìˆ˜í–‰í•˜ê³  ìˆë‹¤ê°€ ì–´ë””ì„ ê°€ ê°’ì´ ë‹¬ë¼ì§€ëŠ” ê²½ìš°
  useEffect(() => {
    const unsub = store.sub(atom, () => {
      if (typeof delay === 'number') {
        // delay rerendering to wait a promise possibly to resolve
        setTimeout(rerender, delay)
        return
      }
      rerender()
    })
    rerender()
    return unsub
  }, [store, atom, delay])

  useDebugValue(value)
  // TS doesn't allow using `use` always.
  // The use of isPromiseLike is to be consistent with `use` type.
  // `instanceof Promise` actually works fine in this case.
  return isPromiseLike(value) ? use(value) : (value as Awaited<Value>)
}
```

> useAtom

useAtomì€ useStateì™€ ë™ì¼í•œ í˜•íƒœì˜ ë°°ì—´ì„ ë°˜í™˜í•œë‹¤.

ì²« ë²ˆì§¸ë¡œëŠ” atomì˜ í˜„ì¬ ê°’ì„ ë‚˜íƒ€ë‚´ëŠ” useAtomValue í›…ì˜ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ë©°, ë‘ ë²ˆì§¸ë¡œëŠ” atomì„ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” useSetAtom í›…ì„ ë°˜í™˜ë‹¤.

```jsx
export function useSetAtom<Value, Args extends unknown[], Result>(
  atom: WritableAtom<Value, Args, Result>,
  options?: Options,
): SetAtom<Args, Result> {
  const store = useStore(options)
  const setAtom = useCallback(
    (...args: Args) => {
      if (import.meta.env?.MODE !== 'production' && !('write' in atom)) {
        // useAtom can pass non writable atom with wrong type assertion,
        // so we should check here.
        throw new Error('not writable atom')
      }
      // ğŸ“Œ ìŠ¤í† ì–´ì—ì„œ atomì„ ì°¾ì•„ ì§ì ‘ ê°’ì„ ì—…ë°ì´íŠ¸
      // ìŠ¤í† ì–´ì—ì„œëŠ” ìƒˆë¡œìš´ ê°’ì„ ì‘ì„±í•œ ì´í›„ listener í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ ê°’ì˜ ë³€í™”ë¥¼ ì „íŒŒí•˜ê³  ë¦¬ë Œë”ë§ì´ ìˆ˜í–‰ë˜ê²Œ í•œë‹¤.
      return store.set(atom, ...args)
    },
    [store, atom],
  )
  return setAtom
}
```

> ê°„ë‹¨í•œ ì‚¬ìš©ë²•

```jsx
const animeAtom = atom([
  {
    title: 'Ghost in the Shell',
    year: 1995,
    watched: true
  },
  {
    title: 'Serial Experiments Lain',
    year: 1998,
    watched: false
  }
])

// ğŸ“Œ atomì€ ê°’ ë¿ë§Œ ì•„ë‹ˆë¼ í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¥¼ ë°›ì„ ìˆ˜ ìˆìŒ
// ì´ë¥¼ í™œìš©í•´ ë‹¤ë¥¸ atomì˜ ê°’ìœ¼ë¡œë¶€í„° íŒŒìƒëœ atomì„ ë§Œë“¤ ìˆ˜ë„ ìˆìŒ
const progressAtom = atom((get) => {
  const anime = get(animeAtom)
  return anime.filter((item) => item.watched).length / anime.length
})

const AnimeApp = () => {
  // ğŸ“Œ useAtomìœ¼ë¡œ useStateì™€ ë¹„ìŠ·í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
  const [anime, setAnime] = useAtom(animeAtom)

  return (
    <>
      <ul>
        {anime.map((item) => (
          <li key={item.title}>{item.title}</li>
        ))}
      </ul>
      <button onClick={() => {
        setAnime((anime) => [
          ...anime,
          {
            title: 'Cowboy Bebop',
            year: 1998,
            watched: false
          }
        ])
      }}>
        Add Cowboy Bebop
      </button>
    <>
  )
}

const ProgressTracker = () => {
  // ğŸ“Œ useAtomValueë¡œ getterë§Œ ê°€ì ¸ì˜¬ ìˆ˜ë„ ìˆìŒ
  const progress = useAtomValue(progressAtom)

  return (
    <div>{Math.trunc(progress * 100)}% watched</div>
  )
}

const App = () => {
  return (
    <>
      <AnimeApp />
      <ProgressTracker />
    </>
  )
}
```

ê¸°ë³¸ì ì¸ API ì™¸ì—ë„ localStorageì™€ ì—°ë™í•´ ì˜êµ¬ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê±°ë‚˜, Next.js, ë¦¬ì•¡íŠ¸ ë„¤ì´í‹°ë¸Œì™€ ì—°ë™í•˜ëŠ” ë“± ìƒíƒœì™€ ê´€ë ¨ëœ ë‹¤ì–‘í•œ ì‘ì—…ì„ ì§€ì›í•œë‹¤.

> íŠ¹ì§•

- Recoilì˜ atom ê°œë…ì„ ë„ì…í•˜ë©´ì„œë„ APIê°€ ê°„ê²°í•˜ë‹¤. (ê°ì²´ì˜ ì°¸ì¡°ë¥¼ WeapMapì— ë³´ê´€í•´ key ì—†ì´ë„ ì°¸ì¡°ë¥¼ í†µí•´ ê°’ì„ ê´€ë¦¬í•  ìˆ˜ ìˆê¸° ë•Œë¬¸)
- selector ì—†ì´ë„ atom ê°’ì—ì„œ íŒŒìƒëœ ë˜ ë‹¤ë¥¸ ìƒíƒœë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
- Typescriptë¡œ ì‘ì„±ë˜ì–´ íƒ€ì…ì„ ì˜ ì§€ì›í•œë‹¤.
- ë¦¬ì•¡íŠ¸ 18ì˜ ë³€ê²½ëœ APIë¥¼ ì›í™œí•˜ê²Œ ì§€ì›í•˜ë©°, ì •ì‹ ë²„ì „ì´ ì¶œì‹œë¼ìˆì–´ ì‹¤ì œ ì„œë¹„ìŠ¤í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œë„ ë¬´ë¦¬ ì—†ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.


**ì‘ê³  ë¹ ë¥´ë©° í™•ì¥ì—ë„ ìœ ì—°í•œ Zustand**

ZustandëŠ” ë¦¬ë•ìŠ¤ì— ì˜ê°ì„ ë°›ì•„ ë§Œë“¤ì–´ì¡Œë‹¤. í•˜ë‚˜ì˜ ìŠ¤í† ì–´ë¥¼ ì¤‘ì•™ ì§‘ì¤‘í˜•ìœ¼ë¡œ í™œìš©í•´ ì´ ìŠ¤í† ì–´ ë‚´ë¶€ì—ì„œ ê´€ë¦¬í•˜ë¯€ë¡œ ìŠ¤í† ì–´ê°€ ì–´ë–»ê²Œ ë§Œë“¤ì–´ì§€ëŠ”ì§€ ë¨¼ì € ì‚´í´ë´ì•¼ í•œë‹¤.

> Zustandì˜ ë°”ë‹ë¼ ì½”ë“œ

```jsx
const createStoreImpl: CreateStoreImpl = (createState) => {
  type TState = ReturnType<typeof createState>
  type Listener = (state: TState, prevState: TState) => void
  // 5.2.2ì ˆì—ì„œ ë§Œë“¤ì–´ë³¸ ìŠ¤í† ì–´ì™€ ìœ ì‚¬í•˜ê²Œ state ê°’ì„ useState ì™¸ë¶€ì—ì„œ ê´€ë¦¬
  let state: TState
  // Set í˜•íƒœë¡œ ì¶”ê°€, ì‚­ì œ, ì¤‘ë³µ ê´€ë¦¬ê°€ ìš©ì´í•˜ê²Œë” ì„¤ê³„ ë¨
  const listeners: Set<Listener> = new Set()
  // ğŸ“Œ state ê°’ì„ ë³€ê²½í•˜ëŠ” ìš©ë„
  const setState: StoreApi<TState>['setState'] = (partial, replace) => {
    // ...
    // partialì€ stateì˜ ì¼ë¶€ë¶„ë§Œ ë³€ê²½í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©
    const nextState =
      typeof partial === 'function'
        ? (partial as (state: TState) => TState)(state)
        : partial
    // replaceëŠ” stateë¥¼ ì™„ì „íˆ ìƒˆë¡œìš´ ê°’ìœ¼ë¡œ ë³€ê²½í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©
    if (!Object.is(nextState, state)) {
      const previousState = state
      state =
        replace ?? (typeof nextState !== 'object' || nextState === null)
          ? (nextState as TState)
          : Object.assign({}, state, nextState)
      listeners.forEach((listener) => listener(state, previousState))
    }
  }
  // ğŸ“Œ í´ë¡œì €ì˜ ìµœì‹  ê°’ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ í•¨ìˆ˜
  const getState: StoreApi<TState>['getState'] = () => state

  const getInitialState: StoreApi<TState>['getInitialState'] = () =>
    initialState

  // ğŸ“Œ listnerë¥¼ ë“±ë¡í•´ì„œ ìƒíƒœ ê°’ì´ ë³€ê²½ë  ë•Œ ë¦¬ë Œë”ë§ì´ í•„ìš”í•œ ì»´í¬ë„ŒíŠ¸ë¡œ ì „íŒŒ
  const subscribe: StoreApi<TState>['subscribe'] = (listener) => {
    listeners.add(listener)
    // Unsubscribe
    return () => listeners.delete(listener)
  }
  // ğŸ“Œ listnersë¥¼ ì´ˆê¸°í™”
  const destroy: StoreApi<TState>['destroy'] = () => {
    if (import.meta.env?.MODE !== 'production') {
      console.warn(
        '[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected.',
      )
    }
    listeners.clear()
  }

  const api = { setState, getState, getInitialState, subscribe, destroy }
  const initialState = (state = createState(setState, getState, api))
  return api as any
}
```

ì´ ìŠ¤í† ì–´ ì½”ë“œê°€ ìˆëŠ” íŒŒì¼ì€ `./src/vanilla.ts`ì¸ë°, ì´ íŒŒì¼ì—ì„œ exportí•˜ëŠ” ìœ ì¼í•œ í•¨ìˆ˜ ë° ë³€ìˆ˜ê°€ `createStore`ì´ë‹¤. ë˜í•œ, ê·¸ ì–´ë–¤ ê²ƒë„ import í•˜ê³  ìˆì§€ ì•Šë‹¤. ì¦‰, ì´ storeëŠ” ë¦¬ì•¡íŠ¸ë¥¼ ë¹„ë¡¯í•œ ê·¸ ì–´ë–¤ **í”„ë ˆì„ì›Œí¬ì™€ëŠ” ë³„ê°œë¡œ ì™„ì „íˆ ë…ë¦½ì **ìœ¼ë¡œ êµ¬ì„±ë¼ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. ë”°ë¼ì„œ ìˆœìˆ˜í•˜ê²Œ ìë°”ìŠ¤í¬ë¦½íŠ¸ í™˜ê²½ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```jsx
type CounterStore = {
  count: number,
  increase: (num: number) => void,
}

// ğŸ“Œ storeë¥¼ ë§Œë“¤ ë•Œ setì´ë¼ëŠ” ì¸ìˆ˜ë¥¼ í™œìš©í•´ í˜„ì¬ ìŠ¤í† ì–´ì˜ ê°’ì„ ì¬ì •ì˜í•˜ê±°ë‚˜,
// ë‘ ë²ˆì§¸ ì¸ìˆ˜ë¡œ getì„ ì¶”ê°€í•´ í˜„ì¬ ìŠ¤í† ì–´ì˜ ê°’ì„ ë°›ì•„ì˜¬ ìˆ˜ë„ ìˆë‹¤.
const store = createStore<CounterStore>((set) => ({
  count: 0,
  increase: (num: number) => set((state) => ({ count: state.count + num })),
}))
```

```jsx
store.getState().increase(10)

store.setState((state) => ({ count: state.count + num }))

store.subscribe((state, prev) => {
  if (state.count !== prev.count) {
    console.log('count has been changed', state.count)
  }
})
```

ì´ë ‡ê²Œ ìƒì„±ëœ ìŠ¤í† ì–´ëŠ” getStateì™€ setStateë¥¼ í†µí•´ í˜„ì¬ ìŠ¤í† ì–´ì˜ ê°’ì„ ë°›ì•„ì˜¤ê±°ë‚˜, ì¬ì •ì˜í•  ìˆ˜ ìˆë‹¤. ë˜í•œ subscribeì„ í†µí•´ ìŠ¤í† ì–´ì˜ ê°’ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ íŠ¹ì • í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ìˆ˜ë„ ìˆë‹¤. ì´ subscribeëŠ” í˜„ì¬ ê°’ê³¼ ì´ì „ ê°’ ë‘˜ ë‹¤ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ íŠ¹ì • ê°’ì´ ë³€ê²½ë  ë•Œë§Œ ì‹¤í–‰ë˜ê²Œë” ìµœì í™”í•  ìˆ˜ë„ ìˆë‹¤.

> Zustandì˜ ë¦¬ì•¡íŠ¸ ì½”ë“œ

ë°”ë‹ë¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ì•„ë‹Œ ë¦¬ì•¡íŠ¸ì—ì„œ Zustandë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì–´ë””ì„ ê°€ storeë¥¼ ì½ê³  ë¦¬ë Œë”ë§ì„ í•´ì•¼ í•œë‹¤.

ì´ë¥¼ ë„ì™€ì£¼ëŠ” í•¨ìˆ˜ë“¤ì€ `./src/react.ts`ì—ì„œ ê´€ë¦¬ë˜ê³  ìˆë‹¤.

ë¨¼ì € useStoreë¥¼ ì‚´í´ë³´ì.

```jsx
export function useStore<TState, StateSlice>(
  api: WithReact<ReadonlyStoreApi<TState>>,
  selector: (state: TState) => StateSlice = identity as any,
  equalityFn?: (a: StateSlice, b: StateSlice) => boolean,
) {
  // ...
  // useSyncExternalStoreWithSelectorë¥¼ ì‚¬ìš©í•´ selectorì™€ useStoreì˜ subscribe, getStateë¥¼ ë„˜ê²¨ì¤Œ
  const slice = useSyncExternalStoreWithSelector(
    api.subscribe,
    api.getState,
    api.getServerState || api.getInitialState,
    selector,
    equalityFn,
  )
  useDebugValue(slice)
  return slice
}
```

useSyncExternalStoreWithSelectorëŠ” useSyncExternalStoreì™€ ì™„ì „íˆ ë™ì¼í•˜ì§€ë§Œ ì›í•˜ëŠ” ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” selectorì™€ ë™ë“± ë¹„êµë¥¼ í•  ìˆ˜ ìˆëŠ” equalityFn í•¨ìˆ˜ë¥¼ ë°›ëŠ”ë‹¤ëŠ” ì°¨ì´ê°€ ìˆë‹¤.

useSyncExternalStoreëŠ” ë¦¬ì•¡íŠ¸ 18ì—ì„œ ìƒˆë¡­ê²Œ ë§Œë“¤ì–´ì§„ í›…ìœ¼ë¡œ, ë¦¬ì•¡íŠ¸ ì™¸ë¶€ì—ì„œ ê´€ë¦¬ë˜ëŠ” ìƒíƒœê°’ì„ ë¦¬ì•¡íŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤. ì´ í›…ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì€ 10.2ì ˆ 'ë¦¬ì•¡íŠ¸ 18 ë²„ì „ ì‚´í´ë³´ê¸°'ì—ì„œ ë‹¤ë£¬ë‹¤.

ë‹¤ìŒì€ ë¦¬ì•¡íŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìŠ¤í† ì–´ë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ë³€ìˆ˜ì¸ createë¥¼ ì‚´í´ë³´ì.

```jsx
const createImpl = <T>(createState: StateCreator<T, [], []>) => {
  // ...
  const api =
    typeof createState === 'function' ? createStore(createState) : createState

  // ğŸ“Œ ë°”ë‹ë¼ì˜ createStoreì™€ì˜ ì°¨ì´ì ì€ useStoreë¥¼ ì‚¬ìš©í•´ í•´ë‹¹ ìŠ¤í† ì–´ë¥¼ ì¦‰ì‹œ ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ì¡Œë‹¤ëŠ” ê²ƒ
  const useBoundStore: any = (selector?: any, equalityFn?: any) =>
    useStore(api, selector, equalityFn)

  // ğŸ“Œ useBoundStoreì— apiì˜ ëª¨ë“  í•¨ìˆ˜ë¥¼ ë³µì‚¬í•´ ë™ì¼í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ì œê³µ
  Object.assign(useBoundStore, api)

  return useBoundStore
}
```

ì´ëŸ¬í•œ ê°„ê²°í•œ êµ¬ì¡° ë•ë¶„ì— ë¦¬ì•¡íŠ¸ í™˜ê²½ì—ì„œë„ ìŠ¤í† ì–´ë¥¼ ìƒì„±í•˜ê³  ì‚¬ìš©í•˜ê¸°ê°€ ë§¤ìš° ì‰½ë‹¤.

> ê°„ë‹¨í•œ ì‚¬ìš©ë²•

Zustandì˜ createì„ ì‚¬ìš©í•´ ìŠ¤í† ì–´ë¥¼ ë§Œë“¤ê³ , ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ì´ í›…ì„ ì‚¬ìš©í•´ ìŠ¤í† ì–´ ë‚´ë¶€ì— ìˆì€ getterì™€ setter ëª¨ë‘ì— ì ‘ê·¼í•´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```jsx
import { create } from 'zustand'

const useCountStore = create((set) => ({
  count: 0,
  updateCount: (countCallback) =>
    set((state) => ({ count: countCallback(state.count) })),
}))

function Counter() {
  const count = useCountStore((state) => state.count)
  const updateCount = useCountStore((state) => state.updateCount)
  // ...
}
```

ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ì— storeë¥¼ ë§Œë“œëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë‹¤.

```jsx
import { createStore, useStore } from 'zustand'

const countStore = createStore((set) => ({
  count: 0,
  updateCount: (countCallback) =>
    set((state) => ({ count: countCallback(state.count) })),
}))

function Counter() {
  const count = useStore(countStore((state) => state.count))
  const updateCount = useStore(countStore((state) => state.updateCount))
  // ...
}
```

createStoreë¥¼ ì‚¬ìš©í•˜ë©´ ë¦¬ì•¡íŠ¸ì™€ ìƒê´€ì—†ëŠ” ë°”ë‹ë¼ ìŠ¤í† ì–´ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë©°, ì´ ë°”ë‹ë¼ ìŠ¤í† ì–´ëŠ” useStore í›…ì„ í†µí•´ ì ‘ê·¼í•´ ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

<details>
<summary>`create` vs `createStore`</summary>

createì€ ì‚¬ìš©ì ì§€ì • í›…ìœ¼ë¡œ Context Provider ì—†ì´ ê°„ê²°í•˜ê²Œ ì§€ì—­ ìƒíƒœë¥¼ ì •ì˜í•  ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë‚˜ Contextë¡œ ì‚¬ìš©ë  ë•Œ Reactì˜ í›… ê·œì¹™ì„ ìœ„ë°˜í•  ê°€ëŠ¥ì„±ì´ ìˆìœ¼ë¯€ë¡œ Contextë¥¼ í†µí•´ ì „ë‹¬í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ë‹¤.

createStoreëŠ” ìŠ¤í† ì–´ ê°ì²´ ìì²´ë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ Contextë‚˜ Propì„ í†µí•´ ìŠ¤í† ì–´ë¥¼ ì „ë‹¬í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
  
</details>

> íŠ¹ì§•

- ë¦¬ë•ìŠ¤ ëŒ€ë¹„ ê°„ë‹¨í•˜ê³  ë¹ ë¥´ê²Œ ìƒíƒœë¥¼ ì •ì˜í•  ìˆ˜ ìˆë‹¤.
- Bundlephobia ê¸°ì¤€ìœ¼ë¡œ 2.9kBë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ í¬ê¸°ë„ ê°€ë³ë‹¤.
- APIê°€ ë³µì¡í•˜ì§€ ì•Šê³  ì‚¬ìš©ì´ ê°„ë‹¨í•´ ì‰½ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
- íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë¼ ìˆê¸° ë•Œë¬¸ì— ë³„ë„ì˜ ì²˜ë¦¬ì—†ì´ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- ë¦¬ë•ìŠ¤ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì§€ì›í•œë‹¤.


### 5.2.5 ì •ë¦¬

![image](https://github.com/parkyolo/study-react-deep-dive/assets/39394642/35342a1f-9b5e-42aa-95a3-6f20a34d23ac)

ë¦¬ë•ìŠ¤ë¥¼ ì œì™¸í•œ ì£¼ìš” ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ë‹¤ìš´ë¡œë“œ íšŸìˆ˜ì´ë‹¤.

npmì—ì„œ ì œê³µí•˜ëŠ” ëª¨ë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë©”ì¸í…Œì´ë„ˆê°€ ë§ê³  ë‹¤ìš´ë¡œë“œê°€ í™œë°œí•˜ë©° ì´ìŠˆ ê´€ë¦¬ê°€ ì˜ë˜ê³  ìˆëŠ”ê°€ë„ ì¤‘ìš”í•œ ì„ íƒ ê¸°ì¤€ì´ ëœë‹¤.

ê° ë¼ì´ë¸ŒëŸ¬ë¦¬ë³„ íŠ¹ì§•ì„ ì˜ íŒŒì•…í•˜ê³ , í˜„ì¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìƒí™©ê³¼ ì² í•™ì— ë§ëŠ” ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì ì ˆí•˜ê²Œ ì„ íƒí•´ ì‚¬ìš©í•œë‹¤ë©´ íš¨ìœ¨ì ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“œëŠ” ë° ë„ì›€ì´ ë  ê²ƒì´ë‹¤.
