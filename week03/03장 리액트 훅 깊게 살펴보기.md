# 03ì¥: ë¦¬ì•¡íŠ¸ í›… ê¹Šê²Œ ì‚´í´ë³´ê¸°

í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ì—ì„œ ìƒíƒœë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, í´ë˜ìŠ¤ ì»´í¬ë„ŒíŠ¸ì˜ ìƒëª…ì£¼ê¸° ë©”ì„œë“œë¥¼ ëŒ€ì²´í•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ ìœ„í•´ **í›…(hook)** ì´ ì¶”ê°€ë˜ì—ˆë‹¤.

## 3.1 ë¦¬ì•¡íŠ¸ì˜ ëª¨ë“  í›… íŒŒí—¤ì¹˜ê¸°

### 3.1.1 useState

> `useState`ëŠ” ì»´í¬ë„ŒíŠ¸ì— [stateë³€ìˆ˜](https://ko.react.dev/learn/state-a-components-memory)ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆëŠ” React Hookì…ë‹ˆë‹¤. - React ê³µì‹ ë¬¸ì„œ

í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ **ìƒíƒœë¥¼ ì •ì˜í•˜ê³ , ì´ ìƒíƒœë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” í›…**

```tsx
import { useState } from "react";

const [state, setState] = useState(initialState);
```

- ì´ˆê¸°ê°’ì„ ë„˜ê²¨ì£¼ì§€ ì•Šìœ¼ë©´ `undefined`ë¡œ í• ë‹¹ëœë‹¤.
- `useState` í›…ì˜ ë°˜í™˜ ê°’ì€ ë°°ì—´ì´ë‹¤.
  - ì²« ë²ˆì§¸ ì›ì†ŒëŠ” `state` ê°’ ìì²´ì´ë‹¤.
  - ë‘ ë²ˆì§¸ ì›ì†Œì¸ `setState` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ `state` ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.
- í´ë¡œì €ì™€ `useReducer`ë¥¼ í†µí•´ êµ¬í˜„ë˜ì–´ ìˆë‹¤. (ì±…ì„ ì°¸ê³ )

```tsx
function Component() {
  const [, triggerRender] = useState();
  let state = "hello";

  function handleButtonClick() {
    state = "hi"; // ì§ì ‘ state ê°’ì„ ë³€ê²½
    triggerRender();
  }

  return (
    <>
      <h1>{state}</h1>
      <button onClick={handleButtonClick}>hi</button>
    </>
  );
}
```

ìœ„ì˜ ì»´í¬ë„ŒíŠ¸ëŠ” ë²„íŠ¼ì„ í´ë¦­í•´ë„ ë³€ê²½ëœ `state`ê°€ í™”ë©´ì— ë Œë”ë§ë˜ì§€ ì•ŠëŠ”ë‹¤.

#### â“ ê·¸ë ‡ë‹¤ë©´ `useState`ëŠ” ì–´ë–»ê²Œ í™”ë©´ì„ ë Œë”ë§ ì‹œí‚¤ëŠ”ê°€

ì´í•´ë¥¼ ìœ„í•´ ë¨¼ì € ê°€ìƒë”ì„ ì‚´í´ë³´ì.

- Q. ê°€ìƒë” ì™œì”€?

  - A. ë³€í™”ë“¤ì„ ë¬¶ì–´ DOMì— í•œ ë²ˆì— ë˜ì§€ë ¤ê³ 

- Q. ê°€ìƒë” ì—†ìœ¼ë©´ ì•ˆë¨?

  - A. DOM fragment ë¼ëŠ”ê±° ì“°ë©´ ë¨

- Q. ê·¸ëŸ¼ ê°€ìƒë” ì™œì”€?

  - A. DOM fragment ê´€ë¦¬í•˜ëŠ” ì‘ì—…ì„ í•˜ë‚˜ì”© í•˜ì§€ ì•Šê³ , DOMì— ë˜ì§€ëŠ” ì‘ì—…ë“¤ì„ ë¬¶ì–´ ìë™í™” & ì¶”ìƒí™” ì‹œì¼œì„œ **ë Œë”ë§ì„ ì ê²Œ ë°œìƒì‹œí‚¤ê¸° ìœ„í•´**

  ![dan_abramov's tweet](https://user-images.githubusercontent.com/63194662/226513033-49060ff9-e235-4b00-a887-23319d531aa4.png)

  > ë¦¬ì•¡íŠ¸ != ë¹ ë¥´ë‹¤  
  > ìœ ì§€ë³´ìˆ˜ ê°€ëŠ¥í•œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“œëŠ” ê²ƒì„ ë„ì™€ì£¼ê³ , ëŒ€ë¶€ë¶„ì˜ ê²½ìš° "ì¶©ë¶„íˆ ë¹ ë¥´ë‹¤"

- Q. ê·¸ë˜ì„œ, ë¦¬ì•¡íŠ¸ ê°€ìƒë”ì€ ì–´ë–»ê²Œ ì‘ë™í•¨?

  - A. ![rendering graph](https://user-images.githubusercontent.com/63194662/224787806-16a59a38-7a59-4d83-ba12-830d0460cd1a.png)

  ìœ„ì˜ ì‚¬ì§„ì—ì„œ `commit phase` ì „ì¸ `render phase` ì—ì„œ VDOMì´ ì–´ë–»ê²Œ ë°”ë€Œì—ˆëŠ”ì§€ì— ëŒ€í•œ ê³„ì‚°ì„ í•œë‹¤.  
  ì°¨ì´ë¥¼ ì°¾ëŠ” `diffing` ê³¼ì •ì„ ê±°ì¹œ í›„, ì‹¤ì œ DOMì— ë°˜ì˜ëœë‹¤.  
  ì´ ë•Œ, current VDOMì€ Work In Progress(`WIP`)ê°€ ë˜ê³ , ì‘ì—…ì„ ë§ˆì¹œ `WIP`ëŠ” currentê°€ ëœë‹¤.

<details>
<summary>ë¬´ìŠ¨ ëœ»ì´ëƒë©´..</summary>

<br/>

1. ë³€í™”ê°€ ìƒê¸´ ê²½ìš°, current VDOMì„ ë³µì œí•´ ìƒˆë¡œìš´ `WIP`ë¥¼ ë§Œë“ ë‹¤. `update`
2. ìƒˆë¡œìš´ currentì™€ `WIP`ë¥¼ ë¹„êµí•´ ë³€ê²½ëœ ë¶€ë¶„ì„ ì°¾ëŠ”ë‹¤. `diffing`
3. ë³€ê²½ëœ ë¶€ë¶„ì„ ì‹¤ì œ DOMì— ë°˜ì˜, ì—…ë°ì´íŠ¸ê°€ ì™„ë£Œë˜ë©´ `WIP`ë¥¼ `current`ë¡œ êµì²´í•œë‹¤. `commit`
4. currentëŠ” ë‹¤ìŒ `WIP`ë¥¼ ë§Œë“œëŠ” ë°ì— ì¬í™œìš©ë  ìˆ˜ ìˆë‹¤. (ì„±ëŠ¥ ìµœì í™”)
</details>

<details>
<summary>diffing?</summary>

<br/>

ê¸°ì¡´ì˜ íŠ¸ë¦¬ë¥¼ ë‹¤ë¥¸ íŠ¸ë¦¬ë¡œ ë°”ê¾¸ëŠ” ì‘ì—…ì€ ë³´í†µ `O(n^3)` ì •ë„ ì†Œìš”ëœë‹¤.

ë¦¬ì•¡íŠ¸ì—ì„œëŠ” íŠ¹ì • ìƒí™©ì´ë¼ëŠ” ê°€ì • í•˜ì— `O(n)`ì´ ì†Œìš”ëœë‹¤. `íœ´ë¦¬ìŠ¤í‹± ì•Œê³ ë¦¬ì¦˜`

1. ì´ì „ê³¼ ê°™ìœ¼ë©´, ê·¸ëƒ¥ ì“´ë‹¤.
2. ì´ì „ê³¼ ê°™ì€ ìœ í˜•ì´ì§€ë§Œ ì†ì„±ì´ ë‹¤ë¥´ë©´, í•´ë‹¹ ì†ì„±ì„ ì—…ë°ì´íŠ¸í•œë‹¤.
3. ì´ì „ê³¼ ë‹¤ë¥¸ ìœ í˜•ì´ë¼ë©´, ìƒˆë¡œ ë§Œë“¤ì–´ ê¸°ì¡´ì„ ëŒ€ì²´í•œë‹¤.

ìœ„ì˜ ì•Œê³ ë¦¬ì¦˜ì„ ë°”íƒ•ìœ¼ë¡œ, `diffing` ê³¼ì •ì„ ì‚´í´ë³´ì.

1. ì´ì „ VDOM íŠ¸ë¦¬ì™€ ìƒˆ VDOM íŠ¸ë¦¬ë¥¼ ë¹„êµ
2. ë£¨íŠ¸ ë…¸ë“œë¶€í„° ì‹œì‘í•´ ì´ì „ê³¼ ìƒˆë¡œìš´ ë…¸ë“œ ë¹„êµ
3. ë‘ ë…¸ë“œê°€ ë‹¤ë¥¸ ìœ í˜•ì´ë©´, ìƒˆ ë…¸ë“œë¥¼ ë§Œë“¤ì–´ ê¸°ì¡´ì„ ëŒ€ì²´ `3`
4. ë‘ ë…¸ë“œê°€ ê°™ì€ ìœ í˜•ì´ë©´, ì†ì„±ì„ ë¹„êµ  
   4-1. ë³€ê²½ëœ ì†ì„±ì´ ì—†ìœ¼ë©´, ê·¸ëƒ¥ ì”€ `1`  
   4-2. ë³€ê²½ëœ ì†ì„±ì´ ìˆìœ¼ë©´, í•´ë‹¹ ì†ì„± ì—…ë°ì´íŠ¸ `2`
5. ìì‹ ë…¸ë“œë¥¼ ì¬ê·€ì ìœ¼ë¡œ ë¹„êµ
</details>

<br/>

ì •ë¦¬í•˜ë©´ ë‹¤ìŒ ê·¸ë¦¼ê³¼ ê°™ë‹¤.

![react_state_update](https://user-images.githubusercontent.com/63194662/227137061-ed6df1cf-1a6a-4f5d-aecd-ec0c976ed789.png)

ìì„¸í•œ ë‚´ìš©ì€ [ì¶œì²˜](https://joong-sunny.github.io/react/react2/#%EF%B8%8F%EA%BC%AC%EB%A6%AC%EC%A7%88%EB%AC%B83-vdom%EC%97%90%EC%84%9C%EC%9D%98-diffing-%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98%EC%9D%84-%EC%84%A4%EB%AA%85%ED%95%B4-%EC%A3%BC%EC%8B%9C%EA%B2%A0%EC%96%B4%EC%9A%94)ë¥¼ ì°¸ê³ 

â—ï¸ ì¦‰, `useState`ëŠ” reactì˜ VDOMì„ ì—…ë°ì´íŠ¸í•˜ê³ , reactëŠ” `diffing` ê³¼ì •ìœ¼ë¡œ ë¹„êµ í›„, **ì‹¤ì œ DOMì— ë³€í™”ë¥¼ ì¼ìœ¼í‚¨ë‹¤.**

ì´ëŠ” Reactì˜ ì¬ì¡°ì • (`Reconciliation`)ì´ë¼ í•œë‹¤.

---

#### â“ `useState`ëŠ” ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ê°€

- Q. `setState()`ë¥¼ í˜¸ì¶œí•˜ë©´ ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ ë˜ëŠ”ê°€?

  - A. ê°’ì´ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ê²½ìš°, ë¦¬ë Œë”ë§ì´ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.

- Q. ì—¬ëŸ¬ ë²ˆ ê°’ì„ ë³€ê²½í•˜ë©´, ì—¬ëŸ¬ ë²ˆ ë¦¬ë Œë”ë§ì´ ë°œìƒí•˜ëŠ”ê°€?

  - A.

  ```tsx
  const [state, setState] = useState(0)
  setState(1)
  setState(2)
  ...
  ```

  ìœ„ì™€ ê°™ì´ stateë¥¼ 0 => 1 => 2 ë¡œ ë‘ ë²ˆ ë°”ê¿”ë„ ë¦¬ë Œë”ë§ì€ í•œ ë²ˆ ì¼ì–´ë‚œë‹¤.

- Q. ì™œ í•œ ë²ˆë§Œ ë°œìƒí•˜ëŠ”ê°€?

  - A. `setState`ëŠ” `dispatchAction`(ë¦¬ì•¡íŠ¸18ì˜ `dispatchSetState`)ì„ í†µí•´ stateë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤. `dispatchAction`ì€ í•œ ê°ì²´ì— ëŒ€í•œ ì—…ë°ì´íŠ¸ë¥¼ ëª¨ì•„ í•œ ë²ˆì— ì²˜ë¦¬í•œë‹¤.

- Q. `dispatchAction`ì´ ë­”ë°?

  - A. ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸ í•´ì£¼ëŠ” í•¨ìˆ˜

  `useReducer`, `useContext`, `useCallback` ë“±ì˜ í›…ë„ ë‚´ë¶€ì ìœ¼ë¡œ ì´ í•¨ìˆ˜ë¡œ ì—…ë°ì´íŠ¸í•œë‹¤.

  ```tsx
  function dispatchSetState(fiber, queue, action) {
    const lane = requestUpdateLane(fiber);
    const update = {
      lane,
      action,
      hasEagerState,
      eagerState,
      next,
    };

    if (isRenderPhaseUpdate(fiber)) {
      // íì— ì—…ë°ì´íŠ¸ ì§‘ì–´ë„£ìŒ
    } else {
      // render phase ì•„ë‹˜? ì´ì „ ì—…ë°ì´íŠ¸ ì—†ìŒ?
      // ë‚´ê°€ ì—…ë°ì´íŠ¸ í•´ì¤„í…Œë‹ˆ ëŒ€ê¸°í•˜ì…ˆ

      // ë¹„ë™ê¸° ì‹œì‘
      enqueueConcurrentHookUpdateAndEagerlyBailout(fiber, queue, update);
      // ë¹„ë™ê¸° ë
    }
    scheduleUpdateOnFiber(root, fiber, lane, eventTime);
  }
  ```

  1. `requestUpdateLane` í•¨ìˆ˜ë¡œ ìš°ì„ ìˆœìœ„(`lane`) ì„ ì •í•œë‹¤.
  2. `update` ê°ì²´ë¥¼ ë§Œë“ ë‹¤.
  3. render phaseì¸ì§€ í™•ì¸í•˜ê³  ì—…ë°ì´íŠ¸í•œë‹¤.
  4. ì§€ê¸ˆ ì—…ë°ì´íŠ¸ ëª»í•˜ë©´, íì— ë„£ì–´ ë‚˜ì¤‘ì— ì²˜ë¦¬í•œë‹¤.

  â—ï¸ íì— ë„£ì–´ì„œ í•œ ë²ˆì— ì²˜ë¦¬í•œë‹¤ â†’ ì—…ë°ì´íŠ¸ë¥¼ í•œ ë²ˆì— ì²˜ë¦¬í•œë‹¤.

**ê²°ë¡ **

```tsx
const [state, setState] = useState(0);
setState(1);
setState(2);
```

1. 0ì„ 1ë¡œ ë°”ê¾¸ëŠ” ì‘ì—…, 2ë¡œ ë°”ê¾¸ëŠ” ì‘ì—…ì„ ì›í˜•íì— ë„£ëŠ”ë‹¤.
2. "1ë¡œ ë°”ê¿”ì¤˜!" ë¼ëŠ” `update`ë¥¼ ì°¾ê³ , ì›í˜• íë¥¼ ëŠëŠ”ë‹¤.
3. `update.next`ê°€ ê°€ë¦¬í‚¤ëŠ” "2ë¡œ ë°”ê¿”ì¤˜!" ë¼ëŠ” `update`ë¥¼ ì°¾ëŠ”ë‹¤.
4. ë” ì´ìƒ ì§„í–‰í•  ê²ƒì´ ì—†ê¸° ë•Œë¬¸ì—, `updateReducer`ëŠ” ìµœì¢… ê²°ê³¼ì¸ `2`ë¥¼ ë¦¬í„´í•œë‹¤.
5. ì´ë¥¼ ë°›ì•„ `updateState`ëŠ” stateì˜ ìµœì¢…ê°’ì„ ë¦¬í„´í•˜ê³ , í™”ë©´ì— ë Œë”ë§ëœë‹¤.
6. ì¦‰, 0 => 2 ë¡œ í•œ ë²ˆì— ì—…ë°ì´íŠ¸ ëœë‹¤.

ë” ìì„¸í•œ ë‚´ìš©ì€ [ì¶œì²˜](https://joong-sunny.github.io/react/react1/#%EF%B8%8F%EA%BC%AC%EB%A6%AC%EC%A7%88%EB%AC%B82-%EA%B7%B8%EB%9F%BC-%EB%91%90%EB%B2%88-%ED%98%B8%EC%B6%9C%ED%95%98%EB%A9%B4-%EB%91%90%EB%B2%88-%EB%A6%AC%EB%A0%8C%EB%8D%94%EB%A7%81-%EC%9D%BC%EC%96%B4%EB%82%98%EB%82%98%EC%9A%94)ë¥¼ ì°¸ê³ 

---

#### ê²Œìœ¼ë¥¸ ì´ˆê¸°í™”

`useState()`ì˜ ì¸ìˆ˜ë¡œëŠ” ë³´í†µ ì›ì‹œê°’ì„ ë„£ì§€ë§Œ, í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ë„£ì–´ì¤„ ìˆ˜ë„ ìˆë‹¤.

```tsx
/*
 * Returns a stateful value, and a function to update it.
 */
function useState<S>(
  initialState: S | (() => S)
): [S, Dispatch<SetStateAction<S>>];
```

`useState`ëŠ” ìœ„ì™€ ê°™ì´ ì •ì˜ë˜ì–´ ìˆëŠ”ë°, `initialState`ëŠ” `General` íƒ€ì… `S`ì™€, ë°˜í™˜ íƒ€ì…ì´ `S`ì¸ ì½œë°± í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤.

```tsx
// ì¦‰, ì´ëŸ°ê²Œ ê°€ëŠ¥í•˜ë‹¤.
const [state, setState] = useState(() => 1);
```

í•¨ìˆ˜ë¥¼ ì™œ ì¸ìë¡œ ë°›ì„ ìˆ˜ ìˆë„ë¡ ì„¤ê³„í–ˆì„ê¹Œ?

ì•„ë˜ ë‚´ìš©ì„ ë³´ì.

```tsx
function ë§¤ìš°_ì˜¤ë˜_ê±¸ë¦¬ëŠ”_ì—°ì‚°() {
  for (let i = 1; i <= 100; i++) {
    for (let i = 1; i <= 100; i++) {
      for (let i = 1; i <= 100; i++) {
        for (let i = 1; i <= 100; i++) {
          for (let i = 1; i <= 5; i++) {}
        }
      }
    }
  }
  return 1;
}

export default function App() {
  const [state, setState] = useState(ë§¤ìš°_ì˜¤ë˜_ê±¸ë¦¬ëŠ”_ì—°ì‚°());

  return (
    <div className="App">
      // í´ë¦­í•  ë•Œë§ˆë‹¤ ìˆ˜ ì´ˆì”© ì§€ì—°ëœë‹¤.
      <button onClick={() => setState((prev) => prev + 1)}>button</button>
      <p>count: {state}</p>
    </div>
  );
}
```

í•´ë‹¹ ì½”ë“œëŠ” ë²„íŠ¼ì„ ëˆŒëŸ¬ `re-render`ê°€ ë°œìƒí•  ë•Œë§ˆë‹¤, `ë§¤ìš°_ì˜¤ë˜_ê±¸ë¦¬ëŠ”_ì—°ì‚°()`ì„ ìˆ˜í–‰í•œë‹¤.

ì´ë¥¼ ê°œì„ í•˜ê¸° ìœ„í•´ lazy initializationì„ ì ìš©í•˜ê²Œ ë˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

```tsx
// 1. í•¨ìˆ˜ì˜ í˜¸ì¶œì´ ì•„ë‹Œ, ì •ì˜ë¥¼ ì¸ìë¡œ ì„¤ì •
const [state, setState] = useState(ë§¤ìš°_ì˜¤ë˜_ê±¸ë¦¬ëŠ”_ì—°ì‚°);
// 2. ì½œë°± í•¨ìˆ˜ë¥¼ ë“±ë¡
const [state, setState] = useState(() => ë§¤ìš°_ì˜¤ë˜_ê±¸ë¦¬ëŠ”_ì—°ì‚°());
```

ì´ëŸ¬í•œ lazy initializationì€ ì–¸ì œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ì„ê¹Œ?

-> ë¬´ê±°ìš´ ì—°ì‚°ì´ ìš”êµ¬ë  ë•Œ

- `local|sessionStorage` ì ‘ê·¼
- `map`, `filter`, `find` ê°™ì€ ë°°ì—´ì— ëŒ€í•œ ì ‘ê·¼
- ì´ˆê¸°ê°’ ê³„ì‚°ì„ í•  ë•Œ, ë¬´ê±°ìš´ ì—°ì‚°ì´ ìš”êµ¬ë˜ëŠ” í•¨ìˆ˜ê°€ ì‹¤í–‰ ë¹„ìš©ì´ í´ ê²½ìš°

---

### 3.1.2 useEffect

> `useEffect`ëŠ” [ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ ì»´í¬ë„ŒíŠ¸ë¥¼ ë™ê¸°í™”](https://ko.react.dev/learn/synchronizing-with-effects)í•˜ëŠ” React Hookì…ë‹ˆë‹¤. - React ê³µì‹ ë¬¸ì„œ

ë¨¼ì € ì¼ë°˜ì ì¸ í˜•íƒœë¥¼ ë³´ì.

```tsx
useEffect(() => {
  // do something
}, [deps]);
```

> ë Œë”ë§í•  ë•Œë§ˆë‹¤ ì˜ì¡´ì„±ì— ìˆëŠ” ê°’ì„ ë³´ë©´ì„œ, ì´ ì˜ì¡´ì„±ì˜ ê°’ì´ ì´ì „ê³¼ ë‹¤ë¥¸ ê²Œ í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´ ë¶€ìˆ˜íš¨ê³¼ë¥¼ ì‹¤í–‰í•˜ëŠ” í‰ë²”í•œ í•¨ìˆ˜

í‰ë²”í•œ í•¨ìˆ˜ì˜ ë‚´ë¶€ êµ¬ì¡°ë¥¼ ëœ¯ì–´ë³´ì.

1. `useEffect()`ëŠ” ìµœì´ˆ ë§ˆìš´íŠ¸ì—ì„œ `mountEffect()`ë¥¼ ì‚¬ìš©í•œë‹¤.

```tsx
function mountEffect(
  create: () => (() => void) | void,
  deps: Array<mixed> | void | null
): void {
  return mountEffectImpl(
    // ğŸ“Œ ì´ í”Œë˜ê·¸ëŠ” Layout Effectsì™€ì˜ ì°¨ì´ì ì„ êµ¬ë¶„í•˜ëŠ” ë° ì¤‘ìš”í•©ë‹ˆë‹¤.
    // ğŸ“Œ PassiveStaticEffectê°€ ë¬´ì—‡ì¸ì§€ëŠ” ë‹¤ë¥¸ ì—í”¼ì†Œë“œì—ì„œ ë‹¤ë£° ê°€ì¹˜ê°€ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.
    PassiveEffect | PassiveStaticEffect,
    HookPassive,
    create,
    deps
  );
}

function mountEffectImpl(fiberFlags, hookFlags, create, deps): void {
  // ğŸ“Œ ìƒˆë¡œìš´ í›…ì„ ìƒì„±í•©ë‹ˆë‹¤.
  const hook = mountWorkInProgressHook();

  const nextDeps = deps === undefined ? null : deps;
  currentlyRenderingFiber.flags |= fiberFlags;
  // ğŸ“Œ pushEffect()ëŠ” Effect ê°ì²´ë¥¼ ìƒì„±í•˜ê³  í›…ì— ì„¤ì •í•©ë‹ˆë‹¤.
  hook.memoizedState = pushEffect(
    // ğŸ“Œ ì´ í”Œë˜ê·¸ëŠ” ì¤‘ìš”í•˜ë©°, ìµœì´ˆ ë§ˆìš´íŠ¸ ì‹œ ì´ Effectë¥¼ ì‹¤í–‰í•´ì•¼ í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
    HookHasEffect | hookFlags,
    create,
    undefined,
    nextDeps
  );
}

function pushEffect(tag, create, destroy, deps) {
  const effect: Effect = {
    // ğŸ“Œ tagëŠ” ì¤‘ìš”í•˜ë©°, ì´ effectë¥¼ ì‹¤í–‰í•´ì•¼ í•˜ëŠ”ì§€ ì—¬ë¶€ë¥¼ í‘œì‹œí•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
    tag,
    // ğŸ“Œ ìš°ë¦¬ê°€ ì „ë‹¬í•˜ëŠ” ì½œë°±
    create,
    // ğŸ“Œ ìš°ë¦¬ê°€ ì½œë°±ì—ì„œ ë°˜í™˜í•˜ëŠ” í´ë¦°ì—… í•¨ìˆ˜
    destroy,
    // ğŸ“Œ ìš°ë¦¬ê°€ ì „ë‹¬í•˜ëŠ” deps ë°°ì—´
    deps,
    // Circular
    next: (null: any), // ğŸ“Œ í•˜ë‚˜ì˜ ì»´í¬ë„ŒíŠ¸ì— ì—¬ëŸ¬ íš¨ê³¼ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  };
  let componentUpdateQueue: null | FunctionComponentUpdateQueue = (currentlyRenderingFiber.updateQueue: any);
  if (componentUpdateQueue === null) {
    componentUpdateQueue = createFunctionComponentUpdateQueue();
    // ğŸ“Œ EffectsëŠ” íŒŒì´ë²„ì˜ updateQueueì— ì €ì¥ë©ë‹ˆë‹¤.
    // ğŸ“Œ Hooksì˜ memoizedStateì™€ ë‹¤ë¥´ë‹¤ëŠ” ê²ƒì— ì£¼ëª©í•˜ì„¸ìš”.
    currentlyRenderingFiber.updateQueue = (componentUpdateQueue: any);
    componentUpdateQueue.lastEffect = effect.next = effect;
  } else {
    // ğŸ’¬ í˜„ì¬ê¹Œì§€ ì»´í¬ë„ŒíŠ¸ì— ì ìš©ëœ ë§ˆì§€ë§‰ íš¨ê³¼
    const lastEffect = componentUpdateQueue.lastEffect;
    if (lastEffect === null) {
      componentUpdateQueue.lastEffect = effect.next = effect;
    } else {
      // ğŸ’¬ ì›í˜• ì—°ê²°ë¦¬ìŠ¤íŠ¸ì— effect ì‚½ì…
      const firstEffect = lastEffect.next;
      lastEffect.next = effect;
      effect.next = firstEffect;
      componentUpdateQueue.lastEffect = effect;
    }
  }
  return effect;
}
```

`useEffect()`ëŠ” `Effect` ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.

- `tag`: ì´ ë¶€ìˆ˜íš¨ê³¼ë¥¼ ìˆ˜í–‰í• ì§€, í•˜ì§€ ì•Šì„ì§€ì— ëŒ€í•œ ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” í”„ë¡œí¼í‹°
- `create`: `useEffect()`ì—ì„œ ì „ë‹¬í•œ ì½œë°± í•¨ìˆ˜
- `destroy`: `useEffect()`ì˜ ì½œë°± í•¨ìˆ˜ì—ì„œ ë°˜í™˜í•œ í´ë¦°ì—… í•¨ìˆ˜ë¥¼ ì €ì¥í•  í”„ë¡œí¼í‹°
- `deps`: `useEffect()`ì˜ ì˜ì¡´ì„± ë°°ì—´
- `next`: í•œ ì»´í¬ë„ŒíŠ¸ì— ì—¬ëŸ¬ ë¶€ìˆ˜íš¨ê³¼ê°€ ìˆëŠ” ê²½ìš°, ì²´ì¸ í˜•ì‹ìœ¼ë¡œ ì—°ê²°í•´ ìˆœì°¨ì ìœ¼ë¡œ ì§„í–‰í•˜ê¸° ìœ„í•œ í”„ë¡œí¼í‹°

ë“±ë¡í•œ ë¶€ìˆ˜íš¨ê³¼ëŠ” `react fiber` ê°ì²´ì˜ `updateQueue`ì— ì €ì¥ëœë‹¤.

ë§ˆìš´íŠ¸ ë‹¨ê³„ì—ì„œëŠ” `updateQueue`ì— ì €ì¥ëœ ë¶€ìˆ˜íš¨ê³¼ê°€ ì—†ìœ¼ë¯€ë¡œ, `if (componentUpdateQueue === null)`ë¡œ ì§„ì…

`updateQueue`ë¥¼ ìƒˆë¡œ ìƒì„±, íì— ë¶€ìˆ˜íš¨ê³¼ ë“±ë¡, `Effect` ê°ì²´ ë°˜í™˜

ë“±ë¡ëœ ë¶€ìˆ˜íš¨ê³¼ëŠ” í˜„ì¬ ì‹œì ì—ì„œ ì‹¤í–‰ë˜ì§€ ì•Šê³ , ì¶”í›„ ì²˜ë¦¬ëœë‹¤.

</br>

2. `re-render` ì—ì„œëŠ” `updateEffect()`ë¥¼ ì‚¬ìš©í•œë‹¤.

```tsx
function updateEffect(
  create: () => (() => void) | void,
  deps: Array<mixed> | void | null
): void {
  return updateEffectImpl(PassiveEffect, HookPassive, create, deps);
}

function updateEffectImpl(fiberFlags, hookFlags, create, deps): void {
  // ğŸ“Œ í˜„ì¬ hookì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
  const hook = updateWorkInProgressHook();

  const nextDeps = deps === undefined ? null : deps;
  let destroy = undefined;

  if (currentHook !== null) {
    // ğŸ“Œ effect hookì˜ memoizedStateëŠ” Effect ê°ì²´ë¼ëŠ” ê²ƒì„ ê¸°ì–µí•˜ì„¸ìš”.
    const prevEffect = currentHook.memoizedState;

    destroy = prevEffect.destroy;
    if (nextDeps !== null) {
      const prevDeps = prevEffect.deps;
      // ğŸ“Œ depsê°€ ë³€ê²½ë˜ì§€ ì•Šìœ¼ë©´ Effect ê°ì²´ë¥¼ ë‹¤ì‹œ ìƒì„±í•˜ê¸°ë§Œ í•©ë‹ˆë‹¤.
      // ë‹¨ìˆœíˆ updateQueueë¥¼ ì¬ìƒì„±í•˜ê³  ì—…ë°ì´íŠ¸ëœ create() í•¨ìˆ˜ê°€ í•„ìš”í•˜ê¸° ë•Œë¬¸ì—
      // ì—¬ê¸°ì„œ ë‹¤ì‹œ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ì´ì „ destroy() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      if (areHookInputsEqual(nextDeps, prevDeps)) {
        hook.memoizedState = pushEffect(hookFlags, create, destroy, nextDeps);
        return;
      }
    }
  }

  currentlyRenderingFiber.flags |= fiberFlags;

  hook.memoizedState = pushEffect(
    // ğŸ“Œ HooksHasEffectëŠ” depsê°€ ë³€ê²½ë  ë•Œ Effectë¥¼ ì‹¤í–‰í•´ì•¼ í•¨ì„ í‘œì‹œí•˜ëŠ” í”Œë˜ê·¸ì…ë‹ˆë‹¤.
    HookHasEffect | hookFlags,
    create,
    destroy,
    nextDeps
  );
}
```

ë¨¼ì € í˜„ì¬ í›… ê°ì²´ë¥¼ ë¶ˆëŸ¬ì˜¤ê³ , ì˜ì¡´ì„± ë°°ì—´ì´ ì¸ìˆ˜ë¡œ ì „ë‹¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.  
ì´í›„, ì´ì „ì— ì‹¤í–‰í•œ `Effect` ê°ì²´ì— ì €ì¥í•œ í´ë¦°ì—… í•¨ìˆ˜ë¥¼ `destroy` ë³€ìˆ˜ì— ì €ì¥í•œë‹¤.  
ì˜ì¡´ì„± ë°°ì—´ì´ ì „ë‹¬ë˜ì—ˆë‹¤ë©´ (`nextDeps  !== null`ì´ë©´) ë°°ì—´ ê°’ ë¹„êµ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤. `areHookInputsEqual`

- ì˜ì¡´ì„± ë°°ì—´ì— ì•„ë¬´ ê²ƒë„ ì „ë‹¬í•˜ì§€ ì•Šì•˜ë‹¤ë©´, `Effect` ê°ì²´ë¥¼ ë°”ë¡œ ì—…ë°ì´íŠ¸í•œë‹¤.
- ë‘ ì˜ì¡´ì„± ë°°ì—´ì´ ê°™ë‹¤ë©´, `pushEffect`ë¥¼ í†µí•´ `Effect` ê°ì²´ë¥¼ ë§Œë“¤ê³  ë“±ë¡í•œë‹¤.
  - ì „ë‹¬ëœ `flag`ê°€ ë³€ê²½ë˜ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ì „ë‹¬ëœë‹¤.
- ì˜ì¡´ì„± ë°°ì—´ì´ ë³€ê²½ë˜ì—ˆë‹¤ë©´, í›…ì— ì €ì¥í•œ `Effect` ê°ì²´ì— `flag`ë¥¼ ë³€ê²½ì‹œì¼œ ìƒì„±í•œë‹¤.
  - ì¶”í›„ ì‹¤í–‰ë˜ì–´ì•¼ í•œë‹¤ëŠ” ì˜ë¯¸

â—ï¸ `useEffect` í›…ì˜ ì‹¤í–‰ì—ì„  ë¶€ìˆ˜ íš¨ê³¼ ì‹¤í–‰ì„ ë‹¤ë£¨ì§€ ì•ŠëŠ”ë‹¤. `Effect` ê°ì²´ë¥¼ ë‹¤ì‹œ ìƒì„±í•  ë¿ì´ë‹¤.

<br/>

3. ë¶€ìˆ˜ íš¨ê³¼ëŠ” `commitRoot()`ì—ì„œ ì‹¤í–‰í•œë‹¤.

ë¦¬ì•¡íŠ¸ì˜ `commit` ì‘ì—… ì¤‘, `Effect` ê°ì²´ì— ë“±ë¡ëœ `create()` í•¨ìˆ˜, ì¦‰ `useEffect`ì˜ ë¶€ìˆ˜ íš¨ê³¼ë¥¼ ì‹¤í–‰í•˜ëŠ” íŠ¸ë¦¬ê±°ê°€ ì¡´ì¬í•œë‹¤.

```tsx
// ... ëŒ€ì¶© CommitRoot ì–´ì©Œê³ 

if (
  (finishedWork.subtreeFlags & PassiveMask) !== NoFlags ||
  (finishedWork.flags & PassiveMask) !== NoFlags
) {
  if (!rootDoesHavePassiveEffects) {
    rootDoesHavePassiveEffects = true;
    pendingPassiveEffectsRemainingLanes = remainingLanes;

    pendingPassiveTransitions = transitions;
    scheduleCallback(NormalSchedulerPriority, () => {
      flushPassiveEffects(); // ì–˜ê°€ ì¤‘ìš”

      return null;
    });
  }
}
// ...

function flushPassiveEffectsImpl() {
  // ì–´ì©Œê³  ì €ì©Œê³ 

  // ğŸ“Œ ì½œë°±ì´ ì‹¤í–‰ë˜ê¸° ì „ì— Effect Cleanupì´ ë¨¼ì € ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ëª…í™•í•˜ê²Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  commitPassiveUnmountEffects(root.current);
  commitPassiveMountEffects(root, root.current, lanes, transitions);

  // ì €ì©Œê³ 
}
```

ë¶€ìˆ˜íš¨ê³¼ë¥¼ ì‹¤í–‰í•˜ëŠ” íŠ¸ë¦¬ê±°ëŠ” `flushPassiveEffects` ë¼ëŠ” í•¨ìˆ˜ë‹¤.  
ì–˜ëŠ” í¬ê²Œ 2ê°€ì§€ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.

- `commitPassiveUnmountEffects()`

  - ë“±ë¡ëœ í´ë¦°ì—… í•¨ìˆ˜ë¥¼ ëª¨ë‘ ì‹¤í–‰
  - ì´ ë•Œ, ê°€ì¥ ë ìì‹ ì»´í¬ë„ŒíŠ¸ì˜ í´ë¦°ì—…ë¶€í„° ì‹œì‘

  ```tsx
  do {
    if ((effect.tag & flags) === flags) {
      // Unmount
      const inst = effect.inst;
      const destroy = inst.destroy; // ì–˜ê°€ clean up í•¨ìˆ˜
      if (destroy !== undefined) {
        inst.destroy = undefined;
        safelyCallDestroy(finishedWork, nearestMountedAncestor, destroy); // ì‹¤í–‰í•´ë²„ë¦¬ê¸°
      }
    }
    effect = effect.next;
  } while (effect !== firstEffect);
  ```

- `commitPassiveMountEffects()`

  - í˜„ì¬ ë§ˆìš´íŠ¸ëœ ì»´í¬ë„ŒíŠ¸ì˜ ë¶€ìˆ˜íš¨ê³¼ë¥¼ ì‹¤í–‰
  - ìì‹ ì»´í¬ë„ŒíŠ¸ì˜ ë¶€ìˆ˜íš¨ê³¼ë¶€í„° ì‹¤í–‰

  ```tsx
  do {
    if ((effect.tag & flags) === flags) {
      // flagë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•¨
      // Mount
      const create = effect.create;
      const inst = effect.inst;
      const destroy = create(); // ëŒ€ì¶© ì½œë°±ì´ ì‹¤í–‰ë¨

      inst.destroy = destroy; // ì‹¤í–‰ ê²°ê³¼ì¸ clean up í•¨ìˆ˜ë¥¼ ì €ì¥í•¨
    }
    effect = effect.next;
  } while (effect !== firstEffect);
  ```

â—ï¸ clean up í•¨ìˆ˜ ì‹¤í–‰ â†’ `effect` ì‹¤í–‰ ìˆœìœ¼ë¡œ ë™ì‘ì´ ì§„í–‰ëœë‹¤.

<br/>

4. ì •ë¦¬

- `useEffect()`ëŠ” `Effect` ê°ì²´ë¥¼ ë§Œë“¤ê³  ì»´í¬ë„ŒíŠ¸ì— ì €ì¥í•œë‹¤.
  - `tag` : ë¶€ìˆ˜íš¨ê³¼ ì‹¤í–‰ì´ í•„ìš”í•œì§€ì— ëŒ€í•œ ì—¬ë¶€
  - `create()` : ì²« ë²ˆì§¸ ì¸ìˆ˜ì¸ ì½œë°± í•¨ìˆ˜
  - `destroy()` : `create()`ì—ì„œ ë°˜í™˜ëœ í´ë¦°ì—… í•¨ìˆ˜
- `useEffect()`ëŠ” ì‹¤í–‰ë  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ `Effect` ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
  - ì˜ì¡´ì„± ë°°ì—´ì´ ë³€ê²½ë˜ë©´ ë‹¤ë¥¸ `tag`ë¥¼ ì„¤ì •, ì¶”í›„ ë¶€ìˆ˜íš¨ê³¼ë¥¼ ì‹¤í–‰í•  ê²ƒì´ë¼ê³  í‘œí˜„í•œë‹¤.
- DOMì— ë³€ê²½ì‚¬í•­ ì—…ë°ì´íŠ¸ Commití•  ë•Œ, ë‹¤ìŒ ì‘ì—…ì€ `tag`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ëª¨ë“  ë¶€ìˆ˜íš¨ê³¼ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ë„ë¡ ì˜ˆì•½ëœë‹¤.
- í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì˜ clean up í•¨ìˆ˜ë¥¼ ë¨¼ì € ì²˜ë¦¬í•˜ê³ , ë¶€ìˆ˜íš¨ê³¼ë¥¼ ì‹¤í–‰í•œë‹¤.

ìì„¸í•œ ë‚´ìš©ì€ [ì–´ë ¤ìš´ ì¶œì²˜](https://medium.com/@sanoopark/%EB%A6%AC%EC%95%A1%ED%8A%B8-%EB%82%B4%EB%B6%80-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC-4-useeffect-c86f6b8f447b)ì™€ [ë” ì´í•´í•˜ê¸° ì‰¬ìš´ ì¶œì²˜](https://velog.io/@j7papa/React-Deep-Dive-%EB%94%94%EB%B2%84%EA%B1%B0%EB%A1%9C-%EC%95%8C%EC%95%84%EB%B3%B4%EB%8A%94-useEffect)ë¥¼ ì°¸ê³ 

> í´ë¦°ì—… í•¨ìˆ˜ëŠ” ì–¸ë§ˆìš´íŠ¸ì˜ ê°œë…ì´ ì•„ë‹Œ, í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ëì„ ë•Œ, ì´ì „ ìƒíƒœë¥¼ ì²­ì†Œí•´ì£¼ëŠ” ê°œë…ì´ë¼ê³  ë³´ì.

---

#### ì˜ì¡´ì„± ë°°ì—´ì´ ì—†ëŠ” `useEffect`ì™€ ì¼ë°˜ í•¨ìˆ˜ì˜ ì°¨ì´?

```tsx
function Component() {
  console.log("í•˜ì´ìš”");
}

function Component() {
  useEffect(() => {
    console.log("í•˜ì´ìš”");
  });
}
```

1. `useEffect`ëŠ” í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ë³´ì¥í•œë‹¤.
2. `useEffect`ëŠ” ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ì´ ì™„ë£Œëœ ì´í›„ ë¶€ìˆ˜íš¨ê³¼ê°€ ì‹¤í–‰ëœë‹¤. ìœ„ì²˜ëŸ¼ ì§ì ‘ ì‹¤í–‰í•˜ë©´ ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ë˜ëŠ” ë„ì¤‘ ì‹¤í–‰ë˜ë¯€ë¡œ, ì„œë²„ì—ì„œë„ ì‹¤í–‰ë˜ë©°, í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ì˜ ë°˜í™˜ì„ ì§€ì—°ì‹œí‚¨ë‹¤.

<br/>

#### `useEffect`ë¥¼ ì‚¬ìš©í•  ë•Œì˜ ì£¼ì˜ì 

#### 1. ì˜ì¡´ì„± ë°°ì—´ `eslint` ê²½ê³ ëŠ” ì›¬ë§Œí•˜ë©´ ë¬´ì‹œí•˜ì§€ ë§ˆë¼

ì˜ˆì‹œë¥¼ ë³´ê¸° ì „, `useEffect`ë¥¼ ë¨¼ì € ì´í•´í•˜ê³  ë„˜ì–´ê°€ë³´ì.

- **ëª¨ë“  ë Œë”ë§ì€ ê³ ìœ ì˜ `prop` / `state` / `í•¨ìˆ˜` ë¥¼ ê°€ì§€ê³ ìˆë‹¤.**
  - ê°ê°ì˜ ë Œë”ë§ë§ˆë‹¤ ê²©ë¦¬ëœ ê³ ìœ ì˜ `prop`ê³¼ `state`ë¥¼ **ë³´ëŠ”** ê²ƒì´ë‹¤.
  - ê°ê°ì˜ ë Œë”ë§ì—ì„œ í•¨ìˆ˜ ì•ˆì˜ `state`ì™€ `prop`ì€ ìƒìˆ˜ì´ì ë…ë¦½ëœ ê°’ìœ¼ë¡œ ì¡´ì¬í•œë‹¤.
- **ëª¨ë“  ë Œë”ë§ì€ ê³ ìœ ì˜ `Effect`ë¥¼ ê°€ì§€ê³  ìˆë‹¤.**
  - `Effect` ê°ì²´ ìì²´ê°€ ëª¨ë“  ë Œë”ë§ë§ˆë‹¤ ë³„ë„ë¡œ ì¡´ì¬í•œë‹¤.
  - ë§¤ ë Œë”ë§ë§ˆë‹¤ `Effect`ëŠ” í•´ë‹¹ ë Œë”ë§ì— ì†í•œ `state`, `prop`ì„ **ë°”ë¼ë³´ê³  ìˆë‹¤.**
  - `clean up` ?
    - ìƒˆë¡œìš´ `state`ë¡œ ë Œë”ë§
    - ì´ì „ `state`ë¥¼ ë°”ë¼ë³´ê³  ìˆëŠ” `Effect`ë¥¼ í´ë¦°ì—… = `destroy()`
    - ìƒˆë¡œìš´ `state`ë¥¼ ë°”ë¼ë³´ê³  ìˆëŠ” `Effect` ì‹¤í–‰ = `create()`

<br/>

ìœ„ì˜ ê°œë…ì„ ì´í•´í•˜ê³  ì•„ë˜ì˜ ì˜ˆì‹œë¥¼ ë³´ë„ë¡ í•˜ì.

```tsx
// countë¥¼ 1ì´ˆë§ˆë‹¤ 1ì”© ì˜¬ë¦¬ê³  ì‹¶ì–´
const Counter = () => {
  const [count, setCount] = useState(0);

  useEffect(() => {
    const id = setInterval(() => setCount(count + 1), 1000);
    return () => clearInterval(id);
  }, []); // ë­”ê°€ ì£¼í™©ìƒ‰ ê²½ê³ ê°€ ëœ¬ë‹¤.

  return <h1>{count}</h1>;
};
```

ìœ„ì˜ ì½”ë“œëŠ” `useEffect`ë¥¼ `componentDidMount` ì²˜ëŸ¼ ì‚¬ìš©í•˜ëŠ” ì˜ˆì‹œë‹¤.  
ì´ëŠ” `deps`ë¥¼ ë¹ˆ ë°°ì—´ë¡œ ì„¤ì •í–ˆê¸° ë•Œë¬¸ì—, í•­ìƒ ì´ˆê¸° ìƒíƒœì˜ `state`, `prop`ì„ ì°¸ì¡°í•˜ê²Œ ëœë‹¤.  
ì¦‰, ì˜ë„ì™€ëŠ” ë‹¤ë¥´ê²Œ í™”ë©´ì—ì„œ `count`ëŠ” ê³„ì† `1`ë¡œ í‘œì‹œëœë‹¤.

ê·¸ëŸ¼ ì˜ì¡´ì„± ë°°ì—´ì— `count`ë¥¼ ì§‘ì–´ë„£ì–´ë³´ì.

```tsx
useEffect(() => {
  const id = setInterval(() => setCount(count + 1), 1000);
  return () => clearInterval(id);
}, [count]); // depsì— countë¥¼ ì¶”ê°€í–ˆë‹¤.
```

ë­”ê°€ ì›í•˜ëŠ” ëŒ€ë¡œ ë™ì‘í•˜ëŠ” ê²ƒ ê°™ë‹¤.  
ê·¸ëŸ¬ë‚˜ ì´ë ‡ê²Œ ë³€ê²½í•˜ë©´ `count`ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ `Interval`ì´ ë‹¤ì‹œ ì„¤ì •/í•´ì œëœë‹¤.

â†’ ì´ë ‡ê²Œ ë˜ë©´ ê¸°ì¡´ `Interval`ì„ í•´ì œí•˜ê³  ìƒˆë¡œ ì„¤ì •í•˜ëŠ” ì‹œê°„ì´ ì¶”ê°€ë˜ê³ , ì•½ê°„ì˜ ì§€ì—° ì‹œê°„ì´ ë°œìƒí•œë‹¤. (ì„±ëŠ¥ í•˜ë½ì€ ë¤)

ëŒ€ì‹  `useEffect`ê°€ `state`ì— ì˜ì¡´í•˜ì§€ ì•Šë„ë¡ í•´ë³´ì.

```tsx
useEffect(() => {
  const id = setInterval(() => {
    setCount((prev) => prev + 1); // countë¥¼ ì§ì ‘ ë³€ê²½í•˜ëŠ” ê²ƒ ëŒ€ì‹ 
  }, 1000);
  return () => clearInterval(id);
}, []); // depsê°€ ë¹ˆ ë°°ì—´
```

ì´ë ‡ê²Œ í•˜ë©´ `useEffect`ê°€ í˜„ì¬ `state`ë¥¼ ì•Œ í•„ìš”ê°€ ì—†ë‹¤.  
í•˜ì§€ë§Œ `count` ê°’ì— ë‹¤ë¥¸ ìƒíƒœ ë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ê³  ì‹¶ë‹¤ë©´?

`useReducer`ë¡œ ì—…ë°ì´íŠ¸ ë¡œì§ì„ ë¶„ë¦¬í•´ë³´ì.

```tsx
const initialState = { count: 0, step: 1 };

const reducer = (state, action) => {
  const { count, step } = state;

  if (action.type === "tick") {
    return { count: count + step, step };
  } else if (action.type === "step") {
    return { count, step: action.step };
  } else {
    throw new Error();
  }
};

const Counter = () => {
  const [state, dispatch] = useReducer(reducer, initialState);
  const { count, step } = state;

  useEffect(() => {
    const id = setInterval(() => {
      dispatch({ type: "tick" });
    }, 1000);
    return () => clearInterval(id);
  }, [dispatch]);

  return <h1>{count}</h1>;
};
```

~~ì˜ì¡´ì„± ë°°ì—´ ê²½ê³ ë¥¼ ì¡ê¸° ìœ„í•´ state ì˜ì¡´ì„±ì„ ì—†ì•´ë”ë‹ˆ state ê°’ì´ í•„ìš”í•´ì„œ ì—…ë°ì´íŠ¸ ë¡œì§ì„ ë¶„ë¦¬í•˜ê³ ..~~

<br/>

#### <a name='function-in-useeffect'></a>ê·¸ ì™¸, í•¨ìˆ˜ì˜ ê²½ìš°

- `useEffect` ë‚´ë¶€ì—ì„œë§Œ ì‚¬ìš©ë˜ëŠ” í•¨ìˆ˜ë¼ë©´, í•¨ìˆ˜ë¥¼ `useEffect` ì•ˆìœ¼ë¡œ ì˜®ê²¨ë²„ë¦°ë‹¤.
- `useEffect` ë‚´ë¶€ ë¿ ì•„ë‹ˆë¼ ì—¬ëŸ¬ ê³³ì—ì„œ ë°˜ë³µì ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤ë©´, ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ë¡œ ëŒì–´ì˜¬ë¦¬ê±°ë‚˜ `useCallback`ìœ¼ë¡œ ê°ì‹¼ë‹¤.

<br/>

#### 2. `useEffect`ì˜ ì²« ë²ˆì§¸ ì¸ìˆ˜ì— í•¨ìˆ˜ëª…ì„ ë¶€ì—¬í•˜ë¼

```tsx
// ê°„ë‹¨í•œ í›…ì´ë©´ ì´ë ‡ê²Œ ì¨ë„ ë˜ëŠ”ë°
useEffect(() => {
  console.log(user.id);
}, [user.id]);

// ë³µì¡í•œê±°ë©´ ì´ë ‡ê²Œ ì“°ë¼ëŠ” ëœ»
useEffect(function fetchUserId() {
  fetch(`${ëŒ€ì¶©_ë°±ì—”ë“œ_URL}/userId`)
    .then((res) => res.json())
    .then((data) => setData(data));
}, []);
```

<br/>

#### 3. ê±°ëŒ€í•œ `useEffect`ë¥¼ ë§Œë“¤ì§€ ë§ˆë¼

ì˜ì¡´ì„± ë°°ì—´ì˜ ê°’ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ ë¦¬ë Œë”ë§ì´ ë°œìƒí•˜ë©°, `commit phase`ì—ì„œ ë¶€ìˆ˜íš¨ê³¼ê°€ ì‹¤í–‰ëœë‹¤ê³  í–ˆë‹¤.  
ì´ ë¶€ìˆ˜íš¨ê³¼ì˜ í¬ê¸°ê°€ ì»¤ì§ˆìˆ˜ë¡ ì„±ëŠ¥ì—ëŠ” ì•…ì˜í–¥ì„ ë¯¸ì¹œë‹¤.

<br/>

#### 4. ë¶ˆí•„ìš”í•œ ì™¸ë¶€ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì§€ ë§ˆë¼

`useEffect`ê°€ ì‹¤í–‰í•˜ëŠ” ì½œë°± ë˜í•œ ë¶ˆí•„ìš”í•˜ê²Œ ì¡´ì¬í•´ì„œëŠ” ì•ˆëœë‹¤.  
ëŒ€ì¶© [ìœ„ì— ë‹¤ë£¬ ë‚´ìš©](#function-in-useeffect)ì´ë¯€ë¡œ ë„˜ì–´ê°„ë‹¤.

---

### 3.1.3 useMemo

> `useMemo`ëŠ” ì¬ë Œë”ë§ ì‚¬ì´ì— ê³„ì‚° ê²°ê³¼ë¥¼ ìºì‹±í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” React Hook ì…ë‹ˆë‹¤. - React ê³µì‹ ë¬¸ì„œ

ë¹„ìš©ì´ í° ì—°ì‚° ê²°ê³¼ë¥¼ ì €ì¥<sup>memoization</sup>í•´ ë‘ê³ , ì €ì¥ ê°’ì„ ë°˜í™˜í•˜ëŠ” í›…

![stop-use-useMemo](https://velog.velcdn.com/images/lky5697/post/baa74aa3-f17a-48da-bf5a-a8e903d9e927/image.png)

~~ë§ëŠ” ë§ì¸ê°€?~~

- ì²« ë²ˆì§¸ ì¸ìˆ˜: ì–´ë– í•œ ê°’(ì»´í¬ë„ŒíŠ¸)ì„ ë°˜í™˜í•˜ëŠ” ìƒì„± í•¨ìˆ˜
- ë‘ ë²ˆì§¸ ì¸ìˆ˜: í•´ë‹¹ í•¨ìˆ˜ê°€ ì˜ì¡´í•˜ëŠ” ê°’ì˜ ë°°ì—´

ì˜ì¡´ì„± ë°°ì—´ì˜ ê°’ì´ ë³€ê²½ë˜ì§€ ì•Šìœ¼ë©´, í•¨ìˆ˜ë¥¼ ì¬ì‹¤í–‰í•˜ì§€ ì•Šê³  ì´ì „ ê°’ì„ ë°˜í™˜í•œë‹¤.

ì˜ì¡´ì„± ë°°ì—´ì˜ ê°’ì´ ë³€ê²½ëìœ¼ë©´, ì²« ë²ˆì§¸ ì¸ìˆ˜ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ê³ , ê°’ì„ ë°˜í™˜í•˜ê³ , ê°’ì„ ê¸°ì–µí•´ë‘”ë‹¤.

```tsx
const ë§¤ìš°_ë¹„ì‹¼_ì—°ì‚°ì„_ê°€ì§„_ì»´í¬ë„ŒíŠ¸ = () => {
  const [count, setCount] = useState(0);

  const ê³„ì‚°_ë¹„ìš©ì´_ë§¤ìš°_ë¹„ì‹¼_í•¨ìˆ˜ = (num) => {
    console.log("ê³±í•´");
    return num * 2;
  };

  const calculatedValue = useMemo(
    () => ê³„ì‚°_ë¹„ìš©ì´_ë§¤ìš°_ë¹„ì‹¼_í•¨ìˆ˜(count),
    [count]
  );

  return (
    <>
      <p>Count: {count}</p>
      <p>Calculated Value: {calculatedValue}</p>
      <button onClick={() => setCount((prev) => prev + 1)}>ê³±í•˜ëŠ”ê±°ì—ìš”?</button>
    </p>
  );
};
```

ê·¸ë ‡ë‹¤ë©´ ì–˜ëŠ” ì–´ë””ì— ì“°ëŠ”ê°€?

1. **ê³„ì‚° ë¹„ìš©ì´ ë†’ì€ ì—°ì‚°ì˜ ê²°ê³¼ë¥¼ ì €ì¥í•˜ê³  ì¬ì‚¬ìš©í•˜ê¸° ìœ„í•´** - ë‹¹ì—°í•œ ë§ì´ë‹¤.
2. **ì°¸ì¡° ë™ì¼ì„±<sup>Reference Equality</sup>ì„ ìœ ì§€í•˜ê¸° ìœ„í•´** - ë¶ˆí•„ìš”í•œ ìì‹ ì»´í¬ë„ŒíŠ¸ ë¦¬ë Œë”ë§ì„ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.

---

### 3.1.4 useCallback

> `useCallback`ì€ ë¦¬ë Œë”ë§ ê°„ì— í•¨ìˆ˜ ì •ì˜ë¥¼ ìºì‹±í•´ì£¼ëŠ” React Hookì…ë‹ˆë‹¤. - React ê³µì‹ ë¬¸ì„œ

ìœ„ì˜ `useMemo`ëŠ” ê°’ì„ ê¸°ì–µí•œë‹¤.

`useCallback`ì€ ì¸ìˆ˜ë¡œ ë„˜ê²¨ë°›ì€ ì½œë°± í•¨ìˆ˜ ê·¸ ìì²´ë¥¼ ê¸°ì–µí•œë‹¤.

```tsx
const ìì‹_ì»´í¬ë„ŒíŠ¸ = memo(({ name, value, onChange }) => {
  useEffect(() => {
    console.log(name, "ë Œë”ë§ ë˜ëŠ”ê±°ì—ìš”?");
  });

  return (
    <>
      <h1>
        {name} {value ? "ì˜¨" : "ì˜¤í”„"}
      </h1>
      <button onClick={onChange}>ëˆŒëŸ¬ë³´ì…ˆ</button>
    </>
  );
});

function App() {
  const [ìƒíƒœ1, setìƒíƒœ1] = useState(false);
  const [ìƒíƒœ2, setìƒíƒœ2] = useState(false);

  // ì–˜ë¥¼ ëˆŒëŸ¬ë„ ìì‹ ì»´í¬ë„ŒíŠ¸ 2ê°œê°€ ì „ë¶€ ë¦¬ë Œë”ë§ë˜ê³ ,
  const í† ê¸€1 = () => setìƒíƒœ1(!ìƒíƒœ1);
  // ì–˜ë„ ìì‹ ì»´í¬ë„ŒíŠ¸ 2ê°œê°€ ì „ë¶€ ë¦¬ë Œë”ë§ëœë‹¤.
  const í† ê¸€2 = () => setìƒíƒœ2(!ìƒíƒœ2);

  return (
    <>
      <ìì‹_ì»´í¬ë„ŒíŠ¸ name="ë²”" value={ìƒíƒœ1} onChange={í† ê¸€1} />
      <ìì‹_ì»´í¬ë„ŒíŠ¸ name="ë¶€" value={ìƒíƒœ2} onChange={í† ê¸€2} />
    </>
  );
}
```

1. `state`ê°€ ë°”ë€Œë©´ì„œ, `App` ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ëœë‹¤.
2. `App` ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë˜ë©´ì„œ `í† ê¸€1`, `í† ê¸€2` í•¨ìˆ˜ê°€ ì¬ìƒì„±ëœë‹¤. (ì°¸ì¡°ê°€ ë‹¬ë¼ì§)
3. í•¨ìˆ˜ì˜ ì°¸ì¡°ê°€ ë‹¬ë¼ì¡Œìœ¼ë¯€ë¡œ, `ìì‹ ì»´í¬ë„ŒíŠ¸` ì „ë¶€ ë¦¬ë Œë”ë§ëœë‹¤.

ê·¸ëŸ¼ í•¨ìˆ˜ë¥¼ ë©”ëª¨ì´ì œì´ì…˜í•´ë³´ì.

```tsx
// ìì‹ ì»´í¬ë„ŒíŠ¸ëŠ” ë˜‘ê°™ìŒ

function App() {
  // ...

  const í† ê¸€1 = useCallback(
    // ê¸°ëª… í•¨ìˆ˜ë¡œ ë„˜ê²¨ì£¼ë©´ í¬ë¡¬ ë””ë²„ê¹…ì´ ì‰¬ì›€
    function í† ê¸€1() {
      setìƒíƒœ1(!ìƒíƒœ1);
    },
    [ìƒíƒœ1]
  );

  // ì‘ ê·€ì°®ìœ¼ë©´ ìƒëµí•´
  const í† ê¸€2 = useCallback(() => {
    setìƒíƒœ2(!ìƒíƒœ2);
  }, [ìƒíƒœ2]);

  // ...
}
```

ì´ëŸ¬ë©´ ì´ì œ ê° ì˜ì¡´ì„±ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ í•¨ìˆ˜ê°€ ì¬ìƒì„±ëœë‹¤.

Preactì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ `useMemo`ë¥¼ ì‚¬ìš©í•˜ì—¬ `useCallback`ì´ êµ¬í˜„ë˜ì–´ ìˆë‹¤.

```tsx
export function useCallback(callback, args) {
  currentHook = 8;
  return useMemo(() => callback, args);
}
```

ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ í•¨ìˆ˜ëŠ” ê°’ìœ¼ë¡œ í‘œí˜„ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ìœ„ì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ êµ¬í˜„ì´ ê°€ëŠ¥í•˜ë‹¤.

---

### 3.1.5 useRef

> `useRef`ëŠ” ë Œë”ë§ì— í•„ìš”í•˜ì§€ ì•Šì€ ê°’ì„ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ” React Hookì…ë‹ˆë‹¤. - React ê³µì‹ ë¬¸ì„œ

- ë°˜í™˜ ê°’ ê°ì²´.currentë¡œ ê°’ì— ì ‘ê·¼ ë˜ëŠ” ë³€ê²½í•  ìˆ˜ ìˆë‹¤.
- ê°’ì´ ë³€í•˜ë”ë¼ë„ ë Œë”ë§ì„ ë°œìƒì‹œí‚¤ì§€ ì•ŠëŠ”ë‹¤.

ê·¸ëŸ¼ ì´ê±¸ ì™œ ì“¸ê¹Œ?

1. ê°™ì€ ì»´í¬ë„ŒíŠ¸ê°€ ì—¬ëŸ¬ ê°œ ìˆì„ ë•Œ, ê°ê°ì˜ ì»´í¬ë„ŒíŠ¸ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ë‹¤ë¥¸ ê°’ì„ ê´€ë¦¬í•˜ê³  ì‹¶ì€ ê²½ìš°  
   1-1. ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ ì´í›„ ê°’ì´ ìƒì„±ë˜ë¯€ë¡œ ë©”ëª¨ë¦¬ ìµœì í™”ì— ìš©ì´í•˜ë‹¤.
2. DOMì— ì ‘ê·¼í•˜ê³  ì‹¶ì€ ê²½ìš°

<br/>

> `useRef`ëŠ” ê° ë Œë”ë§ì—ì„œ ì°¸ì¡°í•˜ëŠ” ê°’ì„ ë™ì¼í•œ ê°’ìœ¼ë¡œ ìœ ì§€í•©ë‹ˆë‹¤. - [dante Yoon](https://velog.io/@jay/useRef-%EB%96%A0%EB%A8%B9%EC%97%AC%EB%93%9C%EB%A6%BD%EB%8B%88%EB%8B%A4)

í´ë˜ìŠ¤ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì— ì„ ì–¸ëœ ì¸ìŠ¤í„´ìŠ¤ë“¤ì€ ë¦¬ë Œë”ë§ ì‹œ ê°’ì´ ë³€ê²½ë˜ì§€ ì•ŠëŠ”ë‹¤.

í•˜ì§€ë§Œ í•¨ìˆ˜í˜• ì»´í¬ë„ŒíŠ¸ì—ì„œ ì„ ì–¸ëœ ë³€ìˆ˜ë“¤ì€ ë Œë”ë§ë  ë•Œë§ˆë‹¤ ë‹¤ì‹œ ìƒì„±ëœë‹¤.

â†’ `useRef`ì˜ ì´ˆê¹ƒê°’ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ ë„£ìœ¼ë©´, ê°’ì€ ë³€í•˜ì§€ ì•Šë”ë¼ë„ ë¦¬ë Œë”ë§ ë  ë•Œë§ˆë‹¤ ê³„ì† í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤.

```tsx
const useObserver = (props) => {
  // âŒ Bad. IntersectionObserverëŠ” ëª¨ë“  ë Œë”ë§ì—ì„œ ìƒì„±ë¨
  const ref = useRef(new IntersectionObserver(onIntersect));
  // ...
};

const useObserver = (props) => {
  const ref = useRef(null);

  // âœ… Good. IntersectionObserverëŠ” í•œ ë²ˆ ëŠë¦¬ê²Œ ìƒì„±ë¨
  const getObserver = () => {
    if (ref.current === null) {
      ref.current = new IntersectionObserver(onIntersect);
    }
    return ref.current;
  };

  // í•„ìš”í•  ë•Œ getObserver()ë¥¼ í˜¸ì¶œ
};
```

<br/>

íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì—ì„œëŠ” `useRef`ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì„¸ ë°©ì‹ìœ¼ë¡œ ì •ì˜í•œë‹¤.

1. ì¸ìì˜ íƒ€ì…ê³¼ ì œë„¤ë¦­ì˜ íƒ€ì…ì´ `T`ë¡œ ì¼ì¹˜í•  ê²½ìš°: ë¡œì»¬ ë³€ìˆ˜ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

   ```tsx
   useRef<T>(initialValue: T): MutableRefObject<T>;
   ```

   `MutableRefObject`ëŠ” current í”„ë¡œí¼í‹°ë¥¼ ì§ì ‘ ë³€ê²½ ê°€ëŠ¥í•˜ë‹¤.  
   ë”°ë¼ì„œ í•´ë‹¹ ë°©ë²•ì€ `useState`ì™€ ë‹¤ë¥´ê²Œ ê°’ì´ ë°”ë€” ë•Œ ë¦¬ë Œë”ë§ì„ í•˜ì§€ ì•Šì§€ë§Œ, í™”ë©´ì´ ë¦¬ë Œë”ë§ë˜ì–´ë„ ê°’ì„ ìœ ì§€í•˜ëŠ” ë¡œì»¬ ë³€ìˆ˜ë¡œ í™œìš©í•  ìˆ˜ ìˆë‹¤.

2. ì¸ìì˜ íƒ€ì…ì´ `null`ì„ í—ˆìš©í•  ê²½ìš°: DOM ìš”ì†Œì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

   ```tsx
   useRef<T>(initialValue: T|null): RefObject<T>;
   ```

   ì´ ê²½ìš°, current í”„ë¡œí¼í‹°ë¥¼ ì§ì ‘ ë³€ê²½í•  ìˆ˜ ì—†ë‹¤. (ì°¸ì¡°í•œ DOM ìì²´ëŠ” ë³€ê²½ ë¶ˆê°€)  
   ë‹¨, current í”„ë¡œí¼í‹°ë§Œ readonlyì´ê¸° ë•Œë¬¸ì— current í•˜ìœ„ í”„ë¡œí¼í‹° valueëŠ” ë³€ê²½ ê°€ëŠ¥í•˜ë‹¤. (DOMì˜ ì†ì„±ì€ ë³€ê²½ ê°€ëŠ¥)

3. ì œë„¤ë¦­ íƒ€ì…ì´ `undefined`ì¸ ê²½ìš° (íƒ€ì…ì„ ì§€ì •í•˜ì§€ ì•Šì€ ê²½ìš°)

   ```tsx
   useRef<T = undefined>(): MutableRefObject<T | undefined>;
   ```

   ì˜ˆë¥¼ ë“¤ì–´ `const ref = useRef<HTMLDivElement>();` ì²˜ëŸ¼ ì¸ìê°€ `undefined`ì¼ ê²½ìš°, DOM ìš”ì†Œì˜ ref ì†ì„±ì— ì§€ì •í•  ë•Œ `MutableRefObject` íƒ€ì…ìœ¼ë¡œ ì¸ì‹í•˜ì—¬ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤. (ref ì†ì„±ì€ `RefObject` íƒ€ì…ë§Œ ë°›ëŠ”ë‹¤.

<br/>

ë‹¤ë¥¸ ì˜ˆì‹œë¥¼ í•˜ë‚˜ ë” ë³´ì.

```tsx
function usePrevious(value) {
  const ref = useRef();

  // useEffectëŠ” ë Œë”ë§ ì´í›„ ì‹¤í–‰ë˜ë¯€ë¡œ, returnìœ¼ë¡œ ê°’ì„ ë°˜í™˜ í›„ ref.current ê°’ì´ ì—…ë°ì´íŠ¸ëœë‹¤.
  useEffect(() => {
    ref.current = value;
  }, [value]);

  return ref.current;
}
```

---

### 3.1.6 useContext

> `useContext`ëŠ” ì»´í¬ë„ŒíŠ¸ì—ì„œ [context](https://ko.react.dev/learn/passing-data-deeply-with-context)ë¥¼ ì½ê³  êµ¬ë…í•  ìˆ˜ ìˆëŠ” React Hookì…ë‹ˆë‹¤. - React ê³µì‹ ë¬¸ì„œ

#### Contextê°€ ë¬´ì—‡ì¸ê°€?

```html
<!-- ìƒì†ì„¸ê°€ ì—†ëŠ” ì„¸ê³„ë¼ê³  ê°€ì •í•œë‹¤. -->
<ì¡°ìƒë‹˜ ì¬ì‚°={10ì–µ}>
  <í• ì•„ë²„ì§€ ì¬ì‚°={10ì–µ}>
    <ì•„ë²„ì§€ ì¬ì‚°={10ì–µ}>
      <ë‚˜ ì¬ì‚°={10ì–µ}/>
<!-- ì¡°ìƒë‹˜ì—ì„œ ë‚˜ê¹Œì§€ ì¬ì‚°ì´ ì˜¨ì „íˆ ì „ë‹¬ë˜ë ¤ë©´, í• ì•„ë²„ì§€ì™€ ì•„ë²„ì§€ë„ ì¬ì‚°(props)ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ë„˜ê²¨ì•¼í•œë‹¤. -->
    </ì•„ë²„ì§€>
  </í• ì•„ë²„ì§€>
</ì¡°ìƒë‹˜>
```

ì´ëŸ° ë³µì¡í•œ `props` ì „ë‹¬ êµ¬ì¡°ë¥¼ `props drilling`ì´ë¼ í•œë‹¤.

ê·¸ë¦¬ê³  ì´ëŸ¬í•œ `props drilling`ì„ ê·¹ë³µí•˜ê¸° ìœ„í•´ ~~redux, zustand, recoil...~~ `Context`ë¼ëŠ” ê°œë…ì´ ìƒê¸°ê²Œ ë˜ì—ˆë‹¤.

<br/>

`useContext`ëŠ” `Context`ë¥¼ í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” í›…ì´ë‹¤.

```tsx
const ì›”ê¸‰Context = createContext<{ ì›”ê¸‰: number } | undefined>(undefined);

function ì›”ê¸‰ContextProvider({
  children,
  ì„¸ê¸ˆë—€_ì›”ê¸‰,
}: PropsWithChildren<{ ì„¸ê¸ˆë—€_ì›”ê¸‰: number }>) {
  return (
    <ì›”ê¸‰Context.Provider value={{ ì›”ê¸‰: ì„¸ê¸ˆë—€_ì›”ê¸‰ }}>
      {children}
    </ì›”ê¸‰Context.Provider>
  );
}

function useì›”ê¸‰Context() {
  const context = useContext(ì›”ê¸‰Context);
  // Provider í•˜ìœ„ì—ì„œ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.
  if (context === undefined)
    throw new Error("ì›”ê¸‰ContextProvider ë°–ì—ì„  ì›”ê¸‰ì´ ì—†ë‹¤.");
  return context;
}

const ì›”ê¸‰_ì»´í¬ë„ŒíŠ¸ = () => {
  const { ì›”ê¸‰ } = useì›”ê¸‰Context();
  return <>{ì›”ê¸‰}</>;
};

const í†µì¥_ì»´í¬ë„ŒíŠ¸ = () => {
  return (
    <>
      <ì›”ê¸‰ContextProvider ì„¸ê¸ˆë—€_ì›”ê¸‰={NaN}>
        <ì›”ê¸‰_ì»´í¬ë„ŒíŠ¸ />
      </ì›”ê¸‰ContextProvider>
    </>
  );
};
```

ë‹¤ë§Œ `useContext`ëŠ” ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì•„ë‹Œ, ìƒíƒœë¥¼ ì£¼ì…í•´ ì£¼ëŠ” APIë‹¤.

ë³´í†µì˜ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì¡°ê±´ì„ ë§Œì¡±í•œë‹¤.

1. íŠ¹ì • ìƒíƒœë¥¼ ê¸°ë°˜ìœ¼ë¡œ, ë‹¤ë¥¸ ìƒíƒœë¥¼ ë§Œë“¤ì–´ ë‚¼ ìˆ˜ ìˆë‹¤.
2. ìƒíƒœ ë³€í™”ë¥¼ ìµœì í™”í•  ìˆ˜ ìˆë‹¤.

`useContext`ë¥¼ ì‚¬ìš©í•œë‹¤ê³  í•´ì„œ ë Œë”ë§ ìµœì í™”ê°€ ë˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.

```tsx
const ì›”ê¸‰_ì»´í¬ë„ŒíŠ¸ = () => {
  const { ì›”ê¸‰ } = useì›”ê¸‰Context();

  useEffect(() => {
    console.log("How sweet ì›”ê¸‰ taste");
  });

  return <h3>{ì›”ê¸‰}</h3>;
};

const í†µì¥_ì»´í¬ë„ŒíŠ¸ = () => {
  useEffect(() => {
    console.log("ê½ê½ ì–¼ì–´ë¶™ì€ í†µì¥");
  });

  return <ì›”ê¸‰_ì»´í¬ë„ŒíŠ¸ />;
};

const íšŒì‚¬_ì»´í¬ë„ŒíŠ¸ = () => {
  const [ì‹¸í”¼_ì›”ê¸‰, setì‹¸í”¼_ì›”ê¸‰] = useState(100);

  const handleì›”ê¸‰Change = () => {
    // ì—°ë´‰ ì¸ìƒë¥  10% ã„·ã„·
    setì‹¸í”¼_ì›”ê¸‰((prevì›”ê¸‰) => prevì›”ê¸‰ + 10);
  };

  useEffect(() => {
    console.log("ì‹¸í”¼ êµìœ¡ìƒì€ ì„¸ê¸ˆ ì•ˆë‚´");
  });

  return (
    <>
      <ì›”ê¸‰ContextProvider ì„¸ê¸ˆë—€_ì›”ê¸‰={ì‹¸í”¼_ì›”ê¸‰}>
        <button onClick={handleì›”ê¸‰Change}>ì—°ë´‰ í˜‘ìƒ</button>
        <í†µì¥_ì»´í¬ë„ŒíŠ¸ />
      </ì›”ê¸‰ContextProvider>
    </>
  );
};
```

í•´ë‹¹ êµ¬ì¡°ì—ì„œ `ì—°ë´‰ í˜‘ìƒ` ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì„¸ ê°œì˜ ì»´í¬ë„ŒíŠ¸ê°€ ëª¨ë‘ ë¦¬ë Œë”ë§ëœë‹¤.

```
How sweet ì›”ê¸‰ taste
ê½ê½ ì–¼ì–´ë¶™ì€ í†µì¥
ì‹¸í”¼ êµìœ¡ìƒì€ ì„¸ê¸ˆ ì•ˆë‚´
```

ì—¬ê¸°ì„œ `í†µì¥_ì»´í¬ë„ŒíŠ¸` ë Œë”ë§ ìµœì í™”ë¥¼ ì§„í–‰í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ `React.memo`ë¥¼ ì´ìš©í•œë‹¤.

```tsx
const í†µì¥_ì»´í¬ë„ŒíŠ¸ = memo(() => {
  useEffect(() => {
    console.log("ê½ê½ ì–¼ì–´ë¶™ì€ í†µì¥");
  });

  return <ì›”ê¸‰_ì»´í¬ë„ŒíŠ¸ />;
});
```

---

### 3.1.7 useReducer

> `useReducer`ëŠ” ì»´í¬ë„ŒíŠ¸ì— [reducer](https://ko.react.dev/learn/extracting-state-logic-into-a-reducer)ë¥¼ ì¶”ê°€í•˜ëŠ” React Hookì…ë‹ˆë‹¤. - React ê³µì‹ ë¬¸ì„œ

```tsx
const [state, dispatch] = useReducer(reducer, initialArg, init?)
```

`useState`ë³´ë‹¤ ë³µì¡í•œ ìƒíƒœê°’ì„ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

- ë°˜í™˜ê°’ì€ ê¸¸ì´ê°€ 2ì¸ ë°°ì—´ì´ë‹¤.

  - `state`: í˜„ì¬ `useReducer`ê°€ ê°€ì§„ ê°’
  - `dispatch`: `state`ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜, `action`ì´ë¼ëŠ” `state`ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ê°ì²´ë¥¼ ë„˜ê²¨ì¤€ë‹¤.

- 2ê°œ í˜¹ì€ 3ê°œì˜ ì¸ìˆ˜ë¥¼ í•„ìš”ë¡œ í•œë‹¤.
  - `reducer`: ê¸°ë³¸ `action`ì„ ì •ì˜í•˜ëŠ” í•¨ìˆ˜
  - `initialArg`: `useReducer`ì˜ ì´ˆê¹ƒê°’ (== `initialState`)
  - `init?`: ì´ˆê¹ƒê°’ì„ ì§€ì—°í•´ì„œ ìƒì„±ì‹œí‚¤ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜, ê²Œìœ¼ë¥¸ ì´ˆê¸°í™”ê°€ ì¼ì–´ë‚œë‹¤.

```tsx
interface State {
  count: number;
}

// action íƒ€ì…ê³¼ ë„˜ê²¨ì¤„ ê°’(payload)ë¥¼ ì •ì˜
// êµ³ì´ type, payloadì¼ í•„ìš”ëŠ” ì—†ê³ , ê°ì²´ì¼ í•„ìš”ë„ ì—†ë‹¤.
interface Action {
  type: "up" | "down" | "reset";
  payload: State;
}

// ë¬´ê±°ìš´ ì—°ì‚°ì´ í¬í•¨ëœ lazy initialization í•¨ìˆ˜
const init = (count: State): State => {
  for (let i = 0; i <= 100; i++) {
    for (let i = 0; i <= 100; i++) {
      for (let i = 0; i <= 100; i++) {
        for (let i = 0; i <= 100; i++) {
          for (let i = 0; i <= 5; i++) {}
        }
      }
    }
  }
  return count;
};

const initialState: State = { count: 0 };

// stateì™€ actionì„ ê¸°ë°˜ìœ¼ë¡œ stateê°€ ì–´ë–»ê²Œ ë³€ê²½ë ì§€ ì •ì˜
const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "up":
      return { count: state.count + 1 };
    case "down":
      return { count: state.count - 1 > 0 ? state.count - 1 : 0 };
    case "reset":
      return init(action.payload || { count: 0 });
    default:
      throw new Error(`Unexpected action type ${action.type}`);
  }
};

const Component = () => {
  const [state, dispatch] = useReducer(reducer, initialState, init);

  const handleUpButtonClick = () => dispatch({ type: "up" });
  const handleDownButtonClick = () => dispatch({ type: "down" });
  const handleResetButtonClick = () =>
    dispatch({ type: "reset", payload: { count: 1 } });

  return (
    <>
      <h1>{state.count}</h1>
      <button onClick={handleUpButtonClick}>+</button>
      <button onClick={handleDownButtonClick}>-</button>
      <button onClick={handleResetButtonClick}>reset</button>
    </>
  );
};
```

`useReducer`ì˜ ëª©ì ì€ **ì—…ë°ì´íŠ¸ ë¡œì§ì„ ë¶„ë¦¬**í•˜ëŠ” ê²ƒì´ë‹¤.

ë˜í•œ ì—¬ëŸ¬ `useState`ë¥¼ í•œ ë¡œì§ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ì´ì ì´ ìˆë‹¤.

`useReducer`, `useState` ëª¨ë‘ í´ë¡œì €ë¥¼ í™œìš©í•´ `state` ê°’ì„ ê´€ë¦¬í•˜ë¯€ë¡œ, í•„ìš”ì— ë§ê²Œ ì„ íƒí•˜ì—¬ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

---

### 3.1.8 useImperativeHandle

> `useImperativeHandle`ì€ [ref](https://ko.react.dev/learn/manipulating-the-dom-with-refs)ë¡œ ë…¸ì¶œë˜ëŠ” í•¸ë“¤ì„ ì‚¬ìš©ìê°€ ì§ì ‘ ì •ì˜í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” React í›…ì…ë‹ˆë‹¤. - React ê³µì‹ ë¬¸ì„œ

ìš°ì„  `React.forwardRef` ë¶€í„° ì•Œì•„ë³´ì.

`HTMLElement`ì— ì ‘ê·¼í•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©í•˜ëŠ” `ref`ë¥¼ `props`ë¡œ ë„˜ê¸°ê³  ì‹¶ìœ¼ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?

```tsx
const ìì‹_ì»´í¬ë„ŒíŠ¸ = ({ parentRef }: { parentRef: React.RefObject }) => {
  useEffect(() => {
    // {current: undefined}
    // {current: HTMLInputElement}
    console.log(parentRef);
  }, [parentRef]);

  return <div>hey</div>;
};

const ë¶€ëª¨_ì»´í¬ë„ŒíŠ¸ = () => {
  // ref ê°ì²´ëŠ” React.RefObject<ì œë„¤ë¦­> íƒ€ì…ìœ¼ë¡œ ì •ì˜
  //   ì œë„¤ë¦­ì— nullì„ ëª…ì‹œí•œ ê²½ìš° (useRef<HTMLInputElement | null>(null); )
  //   ref ê°ì²´ëŠ” MutableRefObject<HTMLInputElement | null> íƒ€ì…ìœ¼ë¡œ ì •ì˜ë˜ì–´ DOMì— ì ‘ê·¼ ë¶ˆê°€
  const inputRef = useRef<HTMLInputElement>(null);

  return (
    <>
      <input ref={inputRef} />
      <ìì‹_ì»´í¬ë„ŒíŠ¸ parentRef={inputRef} />
    </>
  );
};
```

~~ì˜ ì‘ë™í•œë‹¤~~

`forwardRef`ëŠ” ìœ„ì˜ ì˜ˆì œì™€ ë™ì¼í•˜ê²Œ ì‘ë™í•˜ë©´ì„œ, ì¼ê´€ì ìœ¼ë¡œ ì‘ë™í•œë‹¤.

ì¦‰, ê°œë°œìëŠ” `forwardRef`ë¥¼ ë³´ê³  "`ref`ë¥¼ ì „ë‹¬í•˜ëŠ”êµ¬ë‚˜~" í•˜ê³  ì˜ˆì¸¡í•  ìˆ˜ ìˆë‹¤.

```tsx
const ìì‹_ì»´í¬ë„ŒíŠ¸ = forwardRef((props, ref) => {
  useEffect(() => {
    // refë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤.
    console.log(ref);
  }, [ref]);

  return <div>hey</div>;
});

const ë¶€ëª¨_ì»´í¬ë„ŒíŠ¸ = () => {
  const inputRef = useRef<HTMLInputElement>(null);

  return (
    <>
      <input ref={inputRef} />
      <!-- refë¡œ ë„˜ê²¨ì¤„ ìˆ˜ ìˆë‹¤. -->
      <ìì‹_ì»´í¬ë„ŒíŠ¸ ref={inputRef} />
    </>
  );
};
```

<br/>

#### ê·¸ë˜ì„œ `useImperativeHandle`ì´ ë­”ë°?

ë¶€ëª¨ì—ê²Œì„œ ë„˜ê²¨ë°›ì€ `ref`ë¥¼ ì›í•˜ëŠ” ëŒ€ë¡œ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” í›…ì´ë‹¤.

ëŒ€ì¶© ì˜ˆì‹œë¥¼ ë³´ì.

```tsx
const ëª¨ë‹¬ = () => {
  const [showëª¨ë‹¬, setShowëª¨ë‹¬] = useState();
  // ì–˜ëŠ” ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸ë¥¼ ë¦¬í„´í•œë‹¤.
};

const ëª¨ë‹¬_ì•ˆì˜_ëª¨ë‹¬ = () => {
  const [showì„œë¸Œëª¨ë‹¬, setShowì„œë¸Œëª¨ë‹¬] = useState();
  // ì–˜ëŠ” ëª¨ë‹¬ì˜ ëª¨ë‹¬ì„ ë¦¬í„´í•œë‹¤.
};

const í˜ì´ì§€ = () => {
  return (
    <>
      <button onClick={openëª¨ë‹¬}>ëª¨ë‹¬ ì—´ê¸°</button>
      <ëª¨ë‹¬>
        <button onClick={openì„œë¸Œëª¨ë‹¬}>ëª¨ë‹¬ ë˜ ì—´ê¸°</button>
      </ëª¨ë‹¬>
      <ëª¨ë‹¬_ì•ˆì˜_ëª¨ë‹¬ />
    </>
  );
};
```

ì´ëŸ° êµ¬ì¡°ì—ì„œ `ëª¨ë‹¬_ì•ˆì˜_ëª¨ë‹¬`ì„ ë‹«ì•˜ì„ ë•Œ, `ëª¨ë‹¬`ë„ í•¨ê»˜ ë‹«ìœ¼ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?

- Q. `í˜ì´ì§€` ì»´í¬ë„ŒíŠ¸ì—ì„œ ëª¨ë‹¬ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ë©´ ë˜ì§€?

  - A. ê·¸ëŸ¼ ì½”ë“œê°€ ì•ˆì´ì˜ì–ì•„. (~~ëª¨ë‹¬ì˜ ìƒíƒœëŠ” ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ê´€ë¦¬í•´ì•¼í•˜ë©°, í˜ì´ì§€ëŠ” í˜ì´ì§€ë§Œì˜..~~)

- Q. ê·¸ëŸ¼ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ì „ì—­ìœ¼ë¡œ ê´€ë¦¬í•˜ë©´ ë˜ì§€?
  - A. ë§Œì•½ ëª¨ë‹¬ì—ë§Œ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•˜ë©´ ë„ˆë¬´ ì¢…ì†ì„±ì´ ì»¤ì§€ëŠ”ë°?

```tsx
const í˜ì´ì§€ = () => {
  const ëª¨ë‹¬Ref = useRef();

  return (
    <>
      <ëª¨ë‹¬ ref={ëª¨ë‹¬Ref} />
      <ëª¨ë‹¬_ì•ˆì˜_ëª¨ë‹¬
        onClickClose={() => {
          ëª¨ë‹¬Ref.current?.onCloseëª¨ë‹¬();
        }}
      />
    </>
  );
};

const ëª¨ë‹¬ = forwardRef(({ props }, ëª¨ë‹¬Ref) => {
  const [showëª¨ë‹¬, setShowëª¨ë‹¬] = useState(false);

  // hookì„ ì´ìš©í•´ ìƒìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•  ë©”ì„œë“œë¥¼ ì„ ì–¸
  useImperativeHandle(ëª¨ë‹¬Ref, () => ({
    onCloseëª¨ë‹¬: () => {
      setShowëª¨ë‹¬(false);
    },
  }));

  return ...
});
```

ì´ëŸ° ì‹ìœ¼ë¡œ ìƒìœ„ ì»´í¬ë„ŒíŠ¸ì¸ `í˜ì´ì§€`ì—ì„œ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì˜ ë©”ì„œë“œì— ì ‘ê·¼í•˜ì—¬ ëª¨ë‹¬ì„ ë‹«ì„ ìˆ˜ ìˆë‹¤.

ì˜ˆì‹œëŠ” [ì¶œì²˜](https://velog.io/@young_mason/useImperativeHandle)ë¥¼ ì°¸ê³ 

> â—ï¸ ë‹¨! ëŒ€ë¶€ë¶„ì˜ ê²½ìš°, `ref`ë¥¼ ì‚¬ìš©í•œ ëª…ë ¹í˜• ì½”ë“œëŠ” í”¼í•´ì•¼ í•œë‹¤. - React ê³µì‹ ë¬¸ì„œ

- [ì™œ ref ìì£¼ ì“°ì§€ ë§ë¼ëŠ”ê±°ì§€?](https://blog.logrocket.com/why-you-should-use-refs-sparingly-in-production/)
  - ë¦¬ì•¡íŠ¸ëŠ” state ê¸°ë°˜ìœ¼ë¡œ ui ë³€ê²½ì´ ì¼ì–´ë‚˜ëŠ” data driven í”„ë ˆì„ì›Œí¬ì¸ë°, `ref`ëŠ” ëª…ë ¹ ë° ì„ ì–¸í˜• í”„ë¡œê·¸ë˜ë° ë°©ì‹
  - `ref` ê°’ê³¼ `state`ë¥¼ ë”°ë¡œ ë“¤ê³  ê°€ë©´ì„œ ë°ì´í„° ì •í•©ì„±ì´ í‹€ë ¤ì§€ëŠ” ê²½ìš°ê°€ ìˆì„ ìˆ˜ ìˆë‹¤.

---

### 3.1.9 useLayoutEffect

> `useLayoutEffect`ëŠ” ë¸Œë¼ìš°ì €ê°€ í™”ë©´ì„ ë‹¤ì‹œ ê·¸ë¦¬ê¸° ì „ì— ì‹¤í–‰ë˜ëŠ” [useEffect](https://ko.react.dev/reference/react/useEffect)ì…ë‹ˆë‹¤. - React ê³µì‹ ë¬¸ì„œ

> â—ï¸ `useLayoutEffect`ë¥¼ ì‚¬ìš©í•˜ë©´ ì„±ëŠ¥ì´ ì €í•˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°€ëŠ¥í•˜ë‹¤ë©´ `useEffect`ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

- ì´ í•¨ìˆ˜ì˜ ì‹œê·¸ë‹ˆì²˜ëŠ” `useEffect`ì™€ ë™ì¼í•˜ë‚˜, ëª¨ë“  DOMì˜ ë³€ê²½ í›„ì— ë™ê¸°ì ìœ¼ë¡œ ë°œìƒí•œë‹¤.

ë¬´ìŠ¨ ëœ»ì¸ì§€ ì´í•´í•˜ê¸° ìœ„í•´ ì‹¤í–‰ ìˆœì„œë¥¼ ë³´ì.

1. ë¦¬ì•¡íŠ¸ê°€ DOMì„ ì—…ë°ì´íŠ¸ (`commit phase`)
2. `useLayoutEffect`ë¥¼ ì‹¤í–‰
3. ë¸Œë¼ìš°ì €ì— ë³€ê²½ì‚¬í•­ ë°˜ì˜
4. `useEffect`ë¥¼ ì‹¤í–‰ (ê°€ë” paint ë‹¨ê³„ì—ì„œ ì‹¤í–‰ë¨)

![uselayouteffect-and-useeffect](https://velog.velcdn.com/images/rookieand/post/27c02182-4bea-48ee-a80d-76099d4f2b80/image.png)

ì´ëŠ” ê²°êµ­ ë¦¬ì•¡íŠ¸ê°€ `useLayoutEffect`ì˜ ì‹¤í–‰ì´ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦° í›„ì— í™”ë©´ì„ ê·¸ë¦°ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.

ì¦‰ ì„±ëŠ¥ ì €í•˜ê°€ ë°œìƒí•  ìˆ˜ ë°–ì— ì—†ë‹¤.

> ë³´í†µì˜ ê²½ìš°ì—” `useEffect`ë¥¼ ì“°ê³ , ì¹˜ëª…ì ì¸ ì‚¬ìš©ì ê²°í•¨ì´ ìˆëŠ” ê²½ìš° ë©”ëª¨ì´ì œì´ì…˜ê³¼ `useLayoutEffect`ë¥¼ ê³ ë ¤í•´ë³´ì.

---

### 3.1.10 useDebugValue

> `useDebugValue`ëŠ” [React DevTools](https://ko.react.dev/learn/react-developer-tools)ì—ì„œ ì»¤ìŠ¤í…€ í›…ì— ë¼ë²¨ì„ ì¶”ê°€í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” React Hookì…ë‹ˆë‹¤. - React ê³µì‹ ë¬¸ì„œ

```tsx
const useDate = () => {
  const date = new Date();
  useDebugValue(date, (date) => `í˜„ì¬ ì‹œê°„: ${date.toString()}`);
  return date;
};
```

---

### 3.1.11 í›…ì˜ ê·œì¹™

1. ìµœìƒìœ„ì—ì„œë§Œ í›…ì„ í˜¸ì¶œí•´ì•¼ í•œë‹¤. ë°˜ë³µë¬¸, ì¡°ê±´ë¬¸, ì¤‘ì²© í•¨ìˆ˜ ë‚´ì—ì„œ í›…ì„ ì‹¤í–‰í•  ìˆ˜ ì—†ë‹¤.
2. ë¦¬ì•¡íŠ¸ í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸, í˜¹ì€ ì‚¬ìš©ì ì •ì˜ í›… ë‘ ê°€ì§€ ê²½ìš°ì—ë§Œ í›…ì„ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤.

í›…ì— ëŒ€í•œ ì •ë³´ëŠ” ë¦¬ì•¡íŠ¸ ë‚´ë¶€ì˜ `index` í‚¤ ê¸°ë°˜ìœ¼ë¡œ êµ¬í˜„ë˜ì–´ ìˆë‹¤. (ê°ì²´ ê¸°ë°˜ ë§í¬ë“œ ë¦¬ìŠ¤íŠ¸ì— ë” ê°€ê¹Œì›€)  
ë”°ë¼ì„œ `useState`, `useEffect` ëª¨ë‘ ìˆœì„œì— í° ì˜í–¥ì„ ë°›ëŠ”ë‹¤.

```tsx
const Component = () => {
  const [count, setCount] = useState<number>(0);
  const [temp, setTemp] = useState<boolean>(false);

  useEffect(() => {
    // ë­”ê°€ í•¨
  }, [count, temp);
};
```

ì´ ì»´í¬ë„ŒíŠ¸ëŠ” íŒŒì´ë²„ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì €ì¥ëœë‹¤.

```tsx
{
  memoizedState: 0, // setCount í›…
  baseState: 0,
  queue: { /** */},
  baseUpdate: null,
  next: { // setTemp í›…
    memoizedState: false,
    baseState: false,
    queue: { /** */},
    baseUpdate: null,
    next: { // useEffect í›…
      memoizedState: {
        tag: 192,
        create: () => {} // useEffectì˜ ì½œë°± í•¨ìˆ˜
        destroy: undefined, // useEffectì˜ clean up í•¨ìˆ˜
        deps: [0, false], // useEffectì˜ ì˜ì¡´ì„± ë°°ì—´
        next: { /** */ },
      },
      // baseState, queue ...
    }
  }
}
```

ê° í›…ì€ íŒŒì´ë²„ ê°ì²´ ë‚´ì—ì„œ ìˆœì„œì— ì˜ì¡´í•˜ì—¬ `state`ë‚˜ `effect`ì˜ ê²°ê³¼ ê°’ì„ ì €ì¥í•˜ê³  ìˆë‹¤. (`next`)

ë”°ë¼ì„œ, í›…ì€ ìµœìƒë‹¨ì— ì„ ì–¸ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.

---

## 3.2 ì‚¬ìš©ì ì •ì˜ í›…ê³¼ ê³ ì°¨ ì»´í¬ë„ŒíŠ¸ ì¤‘ ë¬´ì—‡ì„ ì¨ì•¼ í• ê¹Œ?

### 3.2.1 ì‚¬ìš©ì ì •ì˜ í›…

- ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ê°™ì€ ë¡œì§ì„ ì‚¬ìš©í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ê²ƒ
  - ë„¤ì´ë°ì€ `use`ë¡œ ì‹œì‘í•´ì•¼ í•œë‹¤.

~~ì´ ì±…ì„ ë¯¸ë¦¬ ì½ì—ˆìœ¼ë©´ fetch í•¨ìˆ˜ ë§Œë“œëŠ” ê³ ìƒì„ ì•ˆí–ˆì„í…ë°..~~

### 3.2.2 ê³ ì°¨ ì»´í¬ë„ŒíŠ¸

HOC<sup>Higher Order Component</sup>, ì»´í¬ë„ŒíŠ¸ ìì²´ì˜ ë¡œì§ì„ ì¬ì‚¬ìš©í•˜ê¸° ìœ„í•œ ë°©ë²•

#### React.memo

`props`ë¥¼ ë¹„êµí•˜ì—¬, ì´ì „ `props`ì™€ ê°™ë‹¤ë©´ ë Œë”ë§ì„ ìƒëµí•˜ëŠ” ê³ ì°¨ ì»´í¬ë„ŒíŠ¸

`useMemo`ëŠ” ê°’ì„ ë°˜í™˜í•˜ê¸° ë•Œë¬¸ì—, `JSX` í•¨ìˆ˜ ë°©ì‹ì´ ì•„ë‹Œ `{}` í• ë‹¹ì‹ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

`React.memo`ëŠ” ëª©ì ê³¼ ìš©ë„ë¥¼ ëšœë ·í•˜ê²Œ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤.

```tsx
const ìì‹_ì»´í¬ë„ŒíŠ¸ = memo(({ value }: { value: String }) => {
  // ì–´ì©Œê³  ì €ì©Œê³ 
});

const ë¶€ëª¨_ì»´í¬ë„ŒíŠ¸ = () => {
  const [state, SetState] = useState<number>(1);

  const handleChange = (e: Event) => {
    setState(Number(e.target.value));
  };

  const memoized_ìì‹_ì»´í¬ë„ŒíŠ¸ = useMemo(() => {
    return <ìì‹_ì»´í¬ë„ŒíŠ¸ value='hey' />
  });

  return (
    <>
      <input ... onChange={handleChange} />
      <ìì‹_ì»´í¬ë„ŒíŠ¸ value='hey' />
    </>
  );
};
```

#### ë¦¬ì•¡íŠ¸ ê³ ì°¨ ì»´í¬ë„ŒíŠ¸

- `with` ì ‘ë‘ì‚¬ë¡œ ì‹œì‘í•˜ëŠ” ê´€ìŠµì´ ìˆë‹¤.
- ë¶€ìˆ˜ íš¨ê³¼ë¥¼ ìµœì†Œí™”í•  ê²ƒ
- ìµœì†Œí•œìœ¼ë¡œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

### 3.2.3 ì‚¬ìš©ì ì •ì˜ í›…ê³¼ ê³ ì°¨ ì»´í¬ë„ŒíŠ¸ ì¤‘ ë¬´ì—‡ì„ ì¨ì•¼ í• ê¹Œ?

- `custom Hook`ì€ ë Œë”ë§ì— ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ ì˜í–¥ì„ ìµœì†Œí™”í•˜ì—¬ ê°œë°œìê°€ ì›í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

1. ë™ì¼í•œ ë¡œì§ìœ¼ë¡œ ê°’ì„ ì œê³µí•˜ê±°ë‚˜, íŠ¹ì • í›…ì˜ ì‘ë™ì„ ì›í•œë‹¤ë©´ `custom Hook`ì„ ì“°ì.
2. ë Œë”ë§ì˜ ê²°ê³¼ë¬¼ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ê³µí†µ ë¡œì§ì´ ìˆë‹¤ë©´ ê³ ì°¨ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ì.
